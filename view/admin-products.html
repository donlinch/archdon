<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>管理商品 - SunnyYummy 後台</title>
    <link rel="stylesheet" href="/style.css"> <!-- 引用根目錄的 style.css -->
    <style>
        /* 後台表格樣式 */
        .admin-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        .admin-table th, .admin-table td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        .admin-table th { background-color: #f2f2f2; }
        .admin-table img { max-width: 50px; height: auto; vertical-align: middle;}
        .admin-table .actions a { margin-right: 5px; }
        .add-button { /* 新增按鈕樣式 */
            display: inline-block;
            margin-bottom: 20px;
            padding: 10px 15px;
            background-color: #28a745; /* 綠色 */
            color: white;
            text-decoration: none;
            border-radius: 5px;
        }
        .add-button:hover { background-color: #218838; }
    </style>
</head>
<body>
    <header>
        <h1>管理後台 - 商品管理</h1>
    </header>
    <main class="container">
        <p><a href="/admin">返回後台主頁</a> | <a href="/logout">登出</a></p>
        <hr>

        <a href="/admin/products/new" class="add-button">新增商品</a> <!-- 新增按鈕 -->

        <h2>現有商品列表</h2>
        <table class="admin-table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>圖片</th>
                    <th>名稱</th>
                    <th>價格</th>
                    <th>描述</th>
                    <th>7-11 連結</th>
                    <th>操作</th>
                </tr>
            </thead>
            <tbody id="admin-product-list-body">
                <!-- 商品資料會由 JS 加在這裡 -->
                <tr><td colspan="7">正在載入商品...</td></tr>
            </tbody>
        </table>

    </main>
    <footer>
        <div class="container">
             <p>© 2025 SunnyYummy. All Rights Reserved.</p>
        </div>
    </footer>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const productListBody = document.getElementById('admin-product-list-body');

        fetch('/api/products') // 呼叫我們之前建立的 API
            .then(response => response.ok ? response.json() : Promise.reject('Failed to load'))
            .then(products => {
                productListBody.innerHTML = ''; // 清空載入訊息
                if (products.length === 0) {
                    productListBody.innerHTML = '<tr><td colspan="7">目前沒有商品。</td></tr>';
                    return;
                }

                products.forEach(product => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${product.id}</td>
                        <td><img src="${product.image_url}" alt="${product.name}"></td>
                        <td>${product.name}</td>
                        <td>${product.price}</td>
                        <td>${product.description || ''}</td>
                        <td><a href="${product.seven_eleven_url}" target="_blank">連結</a></td>
                        <td class="actions">
                            <a href="/admin/products/edit/${product.id}">編輯</a>
                            <a href="/admin/products/delete/${product.id}">刪除</a>
                            <!-- 刪除功能通常需要用 POST 或 DELETE 方法配合表單/JS -->
                        </td>
                    `;
                    productListBody.appendChild(row);
                });
            })
            .catch(error => {
                console.error("獲取商品列表失敗:", error);
                productListBody.innerHTML = '<tr><td colspan="7">無法載入商品資料。</td></tr>';
            });
    });
    </script>

</body>
</html>
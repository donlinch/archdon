<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>大富翁遊戲</title>
    <style>
    /* 基本樣式 */
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: 'Arial', sans-serif;
    }

    body {
        background-color: #f5f5f5;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
    }

    .game-container {
        display: flex;
        flex-direction: row;
        align-items: center;
        justify-content: center;
        padding: 1rem;
        max-width: 1200px;
        width: 100%;
    }

    /* 遊戲面板 */
    .game-board {
        position: relative;
        width: 875px;  /* 7 * 125px */
        height: 700px; /* 7 * 100px */
        background-color: #f0f0f0;
        border: 2px solid #333;
    }

    .cell {
        position: absolute;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        width: 125px;  /* 新的格子寬度 */
        height: 100px; /* 新的格子高度，4:5的寬高比 */
        border: 1px solid #666;
        text-align: center;
        font-weight: bold;
        overflow: hidden;
        cursor: pointer;
        transition: transform 0.3s, box-shadow 0.3s;
        padding: 5px;
    }

    .cell.highlighted {
        transform: scale(1.05);
        z-index: 2;
        box-shadow: 0 0 10px 5px rgba(255, 215, 0, 0.7);
        animation: pulse 1s infinite alternate;
    }

    @keyframes pulse {
        0% {
            transform: scale(0.95);
            box-shadow: 0 0 0 0 rgba(255, 255, 255, 0.7);
        }
        
        70% {
            transform: scale(1.05);
            box-shadow: 0 0 0 10px rgba(255, 255, 255, 0);
        }
        
        100% {
            transform: scale(1);
            box-shadow: 0 0 0 0 rgba(255, 255, 255, 0);
        }
    }

    .cell-content {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        width: 100%;
        height: 100%;
        overflow: hidden;
    }

    .cell-title {
        font-size: 0.9rem;
        font-weight: bold;
        margin-bottom: 4px;
    }

    .cell-description {
        font-size: 0.7rem;
        line-height: 1.2;
        overflow: hidden;
        text-overflow: ellipsis;
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
    }

    .player-token {
        position: absolute;
        display: flex;
        align-items: center;
        justify-content: center;
        width: 26px;
        height: 26px;
        border-radius: 50%;
        font-weight: bold;
        font-size: 0.75rem;
        color: white;
        border: 2px solid white;
        z-index: 10;
        transition: left 0.3s ease-in-out, top 0.3s ease-in-out; /* 平滑過渡 */
    }

    .player1-token {
        background-color: #e53e3e; /* 紅色 */
    }

    .player2-token {
        background-color: #3182ce; /* 藍色 */
    }

    .player3-token {
        background-color: #38a169; /* 綠色 */
    }

    /* 控制面板 */
    .control-panel {
        margin-left: 2rem;
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    .title {
        font-size: 1.875rem;
        font-weight: bold;
        margin-bottom: 1.5rem;
    }

    .player-select-container,
    .steps-container {
        background-color: white;
        padding: 1rem;
        border-radius: 0.5rem;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        text-align: center;
        margin-bottom: 1.5rem;
        width: 100%;
    }

    .player-select-container h2,
    .steps-container h2 {
        font-size: 1.25rem;
        font-weight: bold;
        margin-bottom: 0.5rem;
    }

    .player-select {
        display: flex;
        gap: 1rem;
        justify-content: center;
    }

    .player-btn {
        width: 4rem;
        height: 4rem;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: bold;
        font-size: 1.25rem;
        border: none;
        cursor: pointer;
    }

    .player1 {
        background-color: #fc8181; /* 淺紅色 */
    }

    .player1.selected {
        background-color: #e53e3e; /* 深紅色 */
    }

    .player2 {
        background-color: #63b3ed; /* 淺藍色 */
    }

    .player2.selected {
        background-color: #3182ce; /* 深藍色 */
    }

    .player3 {
        background-color: #68d391; /* 淺綠色 */
    }

    .player3.selected {
        background-color: #38a169; /* 深綠色 */
    }

    /* 中央資訊顯示區 */
    .center-info {
        position: absolute;
        left: 262.5px; /* (875 - 350) / 2 */
        top: 200px;
        width: 350px;
        height: 300px;
        background-color: #ff6347; /* 默認橙紅色，會被動態替換 */
        border: 3px dashed #ffffff;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        color: white;
        text-align: center;
        font-weight: bold;
        padding: 15px;
        z-index: 5;
        transition: background-color 0.3s ease; /* 添加顏色過渡效果 */
    }
    
    .center-title {
        font-size: 1.8rem;
        margin-bottom: 15px;
    }
    
    .center-description {
        font-size: 1.2rem;
        line-height: 1.5;
    }
    
    /* 關閉按鈕 */
    .close-btn {
        position: absolute;
        top: 10px;
        right: 10px;
        width: 24px;
        height: 24px;
        background-color: white;
        color: #ff6347;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
        font-weight: bold;
        cursor: pointer;
        box-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
        z-index: 6;
    }
    
    .close-btn:hover {
        background-color: #f8f8f8;
        transform: scale(1.1);
    }
    
    .hidden {
        display: none;
    }
    
    /* 按鈕禁用狀態 */
    .player-btn:disabled,
    .direction-btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
    }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- 左側遊戲面板 -->
        <div id="game-board" class="game-board">
            <!-- 遊戲格子會由 JavaScript 動態生成 -->
        </div>
        
        <!-- 右側控制面板 -->
        <div class="control-panel">
            <h1 class="title">大富翁遊戲</h1>
            
            <!-- 玩家選擇 -->
            <div class="player-select-container">
                <h2>選擇玩家</h2>
                <div class="player-select">
                    <button id="player1-btn" class="player-btn player1 selected">P1</button>
                    <button id="player2-btn" class="player-btn player2">P2</button>
                    <button id="player3-btn" class="player-btn player3">P3</button>
                </div>
            </div>
            
            <!-- 移動方向選擇 -->
            <div class="steps-container">
                <h2>選擇移動方向</h2>
                <div class="direction-buttons">
                    <button id="forward-btn" class="direction-btn forward">前進</button>
                    <button id="backward-btn" class="direction-btn backward">後退</button>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // 在此處直接內嵌我們修復後的JavaScript代碼
        document.addEventListener('DOMContentLoaded', () => {
            // 定義遊戲板的大小和格子尺寸
            const boardSize = 7; // 維持原來的7x7格子數量
            const cellWidth = 125; // 格子寬度
            const cellHeight = 100; // 格子高度 (4:5的寬高比)
            
            // DOM 元素
            const gameBoard = document.getElementById('game-board');
            const player1Btn = document.getElementById('player1-btn');
            const player2Btn = document.getElementById('player2-btn');
            const player3Btn = document.getElementById('player3-btn');
            const forwardBtn = document.getElementById('forward-btn');
            const backwardBtn = document.getElementById('backward-btn');
            
            // 遊戲狀態
            let pathCells = [];
            let player1PathIndex = 0;
            let player2PathIndex = 0;
            let player3PathIndex = 0;
            let selectedPlayer = 1;
            let isMoving = false;
            let highlightedCell = null;
            
            // 動畫相關變數
            const STEP_ANIMATION_DELAY = 300; // 每步移動的延遲時間(毫秒)
            
            // 玩家標記元素
            let player1Token;
            let player2Token;
            let player3Token;
            
            // 初始化遊戲
            function initGame() {
                createPathCells();
                renderBoard();
                addEventListeners();
            }
            
            // 創建路徑格子
            function createPathCells() {
                pathCells = [];
                
                // 首先添加起點/終點 (右下角)
                pathCells.push({
                  x: boardSize - 1,
                  y: boardSize - 1,
                  title: '起點/終點',
                  description: '遊戲的起點和終點。',
                  color: '#FFA500'
                });
                
                // 1. 右側從下到上 (第一步往上)
                for (let y = boardSize - 2; y >= 0; y--) {
                  pathCells.push({
                    x: boardSize - 1,
                    y,
                    title: `右側 ${boardSize - y - 1}`,
                    description: `這是右側第 ${boardSize - y - 1} 格。`,
                    color: getRandomColor()
                  });
                }
                
                // 2. 頂部從右到左 (右上到左上)
                for (let x = boardSize - 2; x >= 0; x--) {
                  pathCells.push({
                    x,
                    y: 0,
                    title: `頂部 ${boardSize - x - 1}`,
                    description: `這是頂部第 ${boardSize - x - 1} 格。`,
                    color: getRandomColor()
                  });
                }
                
                // 3. 左側從上到下 (左上到左下)
                for (let y = 1; y < boardSize; y++) {
                  pathCells.push({
                    x: 0,
                    y,
                    title: `左側 ${y}`,
                    description: `這是左側第 ${y} 格。`,
                    color: getRandomColor()
                  });
                }
                
                // 4. 底部從左到右 (左下到右下，不包括起點/終點)
                for (let x = 1; x < boardSize - 1; x++) {
                  pathCells.push({
                    x,
                    y: boardSize - 1,
                    title: `底部 ${x}`,
                    description: `這是底部第 ${x} 格。`,
                    color: getRandomColor()
                  });
                }
            }
            
            // 生成隨機顏色
            function getRandomColor() {
              const colors = ['#FFD700', '#FF6347', '#4682B4', '#32CD32', '#9370DB', '#FF69B4', '#20B2AA'];
              return colors[Math.floor(Math.random() * colors.length)];
            }
            
            // 渲染遊戲板
            function renderBoard() {
              // 清空遊戲板
              gameBoard.innerHTML = '';
              
              // 創建中央資訊顯示區
              const centerInfo = document.createElement('div');
              centerInfo.className = 'center-info hidden'; // 默認隱藏
              centerInfo.id = 'center-info';
              
              const centerTitle = document.createElement('div');
              centerTitle.className = 'center-title';
              centerTitle.textContent = '表格內容';
              centerTitle.id = 'center-title';
              
              const centerDescription = document.createElement('div');
              centerDescription.className = 'center-description';
              centerDescription.textContent = '點擊任意格子顯示詳細資訊';
              centerDescription.id = 'center-description';
              
              // 添加關閉按鈕
              const closeBtn = document.createElement('div');
              closeBtn.className = 'close-btn';
              closeBtn.textContent = '×';
              closeBtn.addEventListener('click', function(event) {
                event.stopPropagation(); // 阻止事件冒泡
                document.getElementById('center-info').classList.add('hidden');
              });
              
              centerInfo.appendChild(closeBtn);
              centerInfo.appendChild(centerTitle);
              centerInfo.appendChild(centerDescription);
              gameBoard.appendChild(centerInfo);
              
              // 渲染路徑格子
              pathCells.forEach((cell, index) => {
                const cellElement = document.createElement('div');
                cellElement.className = 'cell';
                cellElement.dataset.index = index; // 添加索引屬性方便識別
                
            // 添加點擊事件
                cellElement.addEventListener('click', function() {
                  // 更新中央資訊
                  updateCenterInfo(cell.title, cell.description);
                  // 更新中央資訊區域的背景顏色與點擊的格子顏色一致
                  document.getElementById('center-info').style.backgroundColor = cell.color;
                  // 顯示中央資訊
                  document.getElementById('center-info').classList.remove('hidden');
                });
                
                // 創建格子內容：標題和描述
                const cellContent = document.createElement('div');
                cellContent.className = 'cell-content';
                
                const titleElement = document.createElement('div');
                titleElement.className = 'cell-title';
                titleElement.textContent = cell.title;
                
                const descriptionElement = document.createElement('div');
                descriptionElement.className = 'cell-description';
                descriptionElement.textContent = cell.description;
                
                cellContent.appendChild(titleElement);
                cellContent.appendChild(descriptionElement);
                cellElement.appendChild(cellContent);
                
                cellElement.style.left = `${cell.x * cellWidth}px`;
                cellElement.style.top = `${cell.y * cellHeight}px`;
                cellElement.style.backgroundColor = cell.color;
                
                if (index === highlightedCell) {
                  cellElement.classList.add('highlighted');
                }
                
                gameBoard.appendChild(cellElement);
              });
              
              // 創建玩家1標記
              player1Token = document.createElement('div');
              player1Token.className = 'player-token player1-token';
              player1Token.textContent = 'P1';
              gameBoard.appendChild(player1Token);
              
              // 創建玩家2標記
              player2Token = document.createElement('div');
              player2Token.className = 'player-token player2-token';
              player2Token.textContent = 'P2';
              gameBoard.appendChild(player2Token);
              
              // 創建玩家3標記
              player3Token = document.createElement('div');
              player3Token.className = 'player-token player3-token';
              player3Token.textContent = 'P3';
              gameBoard.appendChild(player3Token);
              
              // 更新玩家位置
              updatePlayerPositions();
            }
            
            // 更新玩家位置
            function updatePlayerPositions() {
              updatePlayerPosition(1, player1PathIndex);
              updatePlayerPosition(2, player2PathIndex);
              updatePlayerPosition(3, player3PathIndex);
            }
            
            // 更新特定玩家的位置
            function updatePlayerPosition(playerNum, pathIndex) {
              let playerToken;
              let offsetX = 0;
              
              // 根據玩家編號選擇對應的標記
              if (playerNum === 1) {
                playerToken = player1Token;
                offsetX = -15; // 左側偏移
              } else if (playerNum === 2) {
                playerToken = player2Token;
                offsetX = 0; // 居中偏移
              } else {
                playerToken = player3Token;
                offsetX = 15; // 右側偏移
              }
              
              const position = getPlayerPosition(pathIndex);
              
              playerToken.style.left = `${position.x * cellWidth + cellWidth/2 + offsetX}px`;
              playerToken.style.top = `${position.y * cellHeight + cellHeight/2 - 15}px`;
            }
            
            // 更新中央資訊
            function updateCenterInfo(title, description) {
              const centerTitle = document.getElementById('center-title');
              const centerDescription = document.getElementById('center-description');
              
              if (centerTitle && centerDescription) {
                // 更新內容
                centerTitle.textContent = title;
                centerDescription.textContent = description;
                
                // 添加動畫效果
                const centerInfo = document.getElementById('center-info');
                centerInfo.style.animation = 'none';
                // 觸發重繪
                void centerInfo.offsetWidth;
                centerInfo.style.animation = 'pulse 1s';
              }
            }
            
            // 獲取玩家位置
            function getPlayerPosition(playerPathIndex) {
              if (pathCells.length === 0) {
                return { x: boardSize - 1, y: boardSize - 1 }; // 預設在右下角
              }
              
              return {
                x: pathCells[playerPathIndex].x,
                y: pathCells[playerPathIndex].y
              };
            }
            
            // 處理方向選擇 (前進或後退)
            function handleDirectionSelection(isForward) {
              if (isMoving) return;
              
              // 修改為只移動一步
              movePlayerStepByStep(1, isForward);
            }
            
            // 逐步移動玩家
            function movePlayerStepByStep(totalSteps, isForward) {
              if (isMoving) return;
              
              isMoving = true;
              highlightedCell = null;
              
              // 禁用所有按鈕
              enableDisableButtons(false);
              
              // 決定當前移動的玩家
              const currentPlayer = selectedPlayer;
              const currentPathIndex = currentPlayer === 1 ? player1PathIndex : 
                                     (currentPlayer === 2 ? player2PathIndex : player3PathIndex);
              
              // 逐步移動
              let stepsLeft = totalSteps;
              let currentIndex = currentPathIndex;
              
              function moveOneStep() {
                // 計算下一步的位置
                let nextIndex;
                
                if (isForward) {
                  nextIndex = currentIndex + 1;
                  // 如果到達終點，回到起點
                  if (nextIndex >= pathCells.length) {
                    nextIndex = 0;
                  }
                } else {
                  nextIndex = currentIndex - 1;
                  // 如果到達起點之前，回到終點
                  if (nextIndex < 0) {
                    nextIndex = pathCells.length - 1;
                  }
                }
                
                // 更新當前位置
                currentIndex = nextIndex;
                
                // 更新玩家位置
                if (currentPlayer === 1) {
                  player1PathIndex = currentIndex;
                } else if (currentPlayer === 2) {
                  player2PathIndex = currentIndex;
                } else {
                  player3PathIndex = currentIndex;
                }
                
                // 更新玩家位置
                updatePlayerPosition(currentPlayer, currentIndex);
                
                // 減少剩餘步數
                stepsLeft--;
                
                // 如果還有步數，繼續移動
                if (stepsLeft > 0) {
                  setTimeout(moveOneStep, STEP_ANIMATION_DELAY);
                } else {
                  // 移動完成
                  finishMoving(currentIndex);
                }
              }
              
              // 開始移動
              setTimeout(moveOneStep, STEP_ANIMATION_DELAY);
            }
            
            // 完成移動
            function finishMoving(finalIndex) {
              isMoving = false;
              highlightedCell = finalIndex;
              
              // 重新渲染以顯示高亮
              renderBoard();
              
              // 在格子高亮的同時也更新中央顯示區域
              const cell = pathCells[finalIndex];
              updateCenterInfo(cell.title, cell.description);
              // 更新中央資訊區域的背景顏色
              document.getElementById('center-info').style.backgroundColor = cell.color;
              // 顯示中央資訊
              document.getElementById('center-info').classList.remove('hidden');
              
              // 啟用按鈕
              enableDisableButtons(true);
            }
            
            // 啟用/禁用按鈕
            function enableDisableButtons(enable) {
              // 玩家選擇按鈕
              player1Btn.disabled = !enable;
              player2Btn.disabled = !enable;
              player3Btn.disabled = !enable;
              
              // 方向按鈕
              forwardBtn.disabled = !enable;
              backwardBtn.disabled = !enable;
            }
            
            // 選擇玩家
            function selectPlayer(playerNum) {
              selectedPlayer = playerNum;
              
              // 更新玩家按鈕樣式
              player1Btn.classList.remove('selected');
              player2Btn.classList.remove('selected');
              player3Btn.classList.remove('selected');
              
              if (playerNum === 1) {
                player1Btn.classList.add('selected');
              } else if (playerNum === 2) {
                player2Btn.classList.add('selected');
              } else {
                player3Btn.classList.add('selected');
              }
            }
            
            // 添加事件監聽器
            function addEventListeners() {
              // 確保所有元素都存在再添加事件監聽器
              if (player1Btn) {
                player1Btn.addEventListener('click', () => selectPlayer(1));
              }
              
              if (player2Btn) {
                player2Btn.addEventListener('click', () => selectPlayer(2));
              }
              
              if (player3Btn) {
                player3Btn.addEventListener('click', () => selectPlayer(3));
              }
              
              // 添加方向按鈕的事件監聽器
              if (forwardBtn) {
                forwardBtn.addEventListener('click', () => handleDirectionSelection(true));
              }
              
              if (backwardBtn) {
                backwardBtn.addEventListener('click', () => handleDirectionSelection(false));
              }
            }
            
            // 初始化遊戲
            initGame();
        });
    </script>
</body>
</html>
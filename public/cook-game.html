<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>æ–™ç†æ€¥å…ˆé‹’ - éŠæˆ²é€²è¡Œä¸­</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#1c1c1c">
  <style>
    :root {
      --primary-color: #32a852;
      --secondary-color: #4CAF50;
      --accent-color: #FF9800;
      --text-color: #f0f0f0;
      --bg-color: #1c1c1c;
      --border-color: #444;
      --card-bg-color: #2a2a2a;
      --btn-cook-bg: #d42a02;
      --btn-assemble-bg: #545251;
      --btn-serve-bg: #005a2e;
    }
    
    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    html, body { height: 100%; overflow: hidden; }

    body {
      font-family: 'Courier New', monospace;
      background-color: #111;
      color: var(--text-color);
      display: flex;
      align-items: center;
      justify-content: center;
      touch-action: manipulation;
    }
    
    .game-wrapper {
        width: 100%; height: 100%;
        max-width: 450px; max-height: 950px;
        background-color: var(--bg-color);
        display: flex; flex-direction: column;
        position: relative; overflow: hidden;
        border: 2px solid #555; border-radius: 20px;
        box-shadow: 0 0 25px rgba(0,0,0,0.6);
    }
    
    .game-header {
      flex-shrink: 0; height: 50px;
      background-color: rgba(0, 0, 0, 0.4);
      display: flex; justify-content: space-between; align-items: center;
      padding: 0 15px;
      border-bottom: 1px solid var(--border-color);
    }
    
    .game-timer { font-size: 1.2em; color: var(--accent-color); font-weight: bold; }
    .game-score { font-size: 1.2em; color: var(--secondary-color); }
    
    .main-area {
        flex: 1;
        display: flex; flex-direction: column;
        overflow-y: auto; padding: 15px;
    }

    .orders-container {
      flex-shrink: 0; margin-bottom: 15px;
      display: flex; flex-direction: column; gap: 10px;
    }

    .order-card {
      background-color: var(--card-bg-color);
      border: 1px solid var(--border-color);
      border-radius: 8px; padding: 12px;
      display: flex; flex-direction: column; gap: 8px;
    }

    .order-details { display: flex; justify-content: space-between; align-items: center; }
    .order-name { font-size: 1.1em; font-weight: bold; }
    .order-ingredients { display: flex; gap: 5px; }
    .ingredient-icon { font-size: 1.2em; }

    .order-timer-text { font-size: 0.8em; color: #aaa; margin-bottom: 4px; text-align: right; }
    .order-timer { width: 100%; height: 6px; background-color: #444; border-radius: 3px; overflow: hidden; }
    .order-timer-fill { height: 100%; background-color: var(--secondary-color); border-radius: 3px; transition: width 0.5s linear; }

    .kitchen-area {
        display: flex; flex-direction: column; gap: 15px;
    }

    .ingredient-stations-container {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
        gap: 8px;
    }

    .ingredient-station {
        background-color: var(--card-bg-color);
        border: 1px solid var(--border-color);
        border-radius: 8px;
        display: flex; flex-direction: column; align-items: center; justify-content: center;
        padding: 5px; font-size: 0.7em;
        aspect-ratio: 1 / 1; cursor: pointer;
        transition: background-color 0.2s;
    }
    .ingredient-station:hover { background-color: rgba(255,255,255,0.1); }
    .station-icon { font-size: 1.8em; margin-bottom: 2px; }

    .action-stations-container {
        display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px;
        padding: 10px 0;
    }

    .action-btn {
        height: 5em; border-radius: 10px; border: none; outline: none;
        background-color: #c7c3c0;
        box-shadow: rgba(0, 0, 0, 0.4) 8px 8px 6px, #ffffff 1.5px 1.5px 2px 0px inset;
        cursor: pointer; transition: 0.1s ease-in-out;
        display: flex; flex-direction: column; align-items: center; justify-content: center;
        gap: 5px;
    }
    .action-btn:active {
        box-shadow: rgba(0, 0, 0, 0.4) 0px 0px 0px, inset 0.5px 0.5px 4px #000000;
    }
    .action-btn .station-icon { font-size: 1.8em; color: white; text-shadow: 1px 1px 2px rgba(0,0,0,0.5); }
    .action-btn .station-label { font-size: 0.8em; color: white; font-weight: bold; }
    .action-btn--cook { background-color: var(--btn-cook-bg); box-shadow: rgba(0, 0, 0, 0.4) 8px 8px 6px, #fb702c 2px 2px 10px 0px inset; }
    .action-btn--assemble { background-color: var(--btn-assemble-bg); box-shadow: rgba(0, 0, 0, 0.4) 8px 8px 6px, #a8a6a4 1.5px 1.5px 1px 0px inset; }
    .action-btn--serve { background-color: var(--btn-serve-bg); box-shadow: rgba(0, 0, 0, 0.4) 8px 8px 6px, #2f9e62 2px 2px 10px 0px inset; }

    .player-inventory {
      flex-shrink: 0; display: grid;
      grid-template-columns: repeat(4, 1fr); grid-template-rows: repeat(2, 1fr);
      gap: 8px; padding: 10px;
      background: rgba(0,0,0,0.2);
      border-top: 1px solid var(--border-color);
    }
    
    .inventory-slot {
      aspect-ratio: 1; background: rgba(0,0,0,0.4);
      border: 1px solid var(--border-color); border-radius: 8px;
      display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      cursor: pointer; position: relative;
      transition: all 0.2s ease;
      color: rgba(255,255,255,0.3);
    }
    
    .inventory-slot.active { border-color: var(--accent-color); transform: scale(1.05); }
    .game-item { font-size: 1.8em; }
    .item-label { font-size: 0.7em; color: #ccc; position: absolute; bottom: 5px; }

    .task-hint {
      position: fixed;
      bottom: 180px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.8);
      padding: 8px 15px;
      border-radius: 20px;
      font-size: 0.9em;
      color: #fff;
      text-align: center;
      z-index: 100;
      pointer-events: none;
    }

    .toast {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0,0,0,0.9);
      color: #fff;
      padding: 10px 20px;
      border-radius: 20px;
      z-index: 1000;
      opacity: 0;
      transition: opacity 0.3s;
    }

    .toast.show {
      opacity: 1;
    }
  </style>
</head>
<body>
  <div class="game-wrapper">
    <div class="game-header">
        <div class="game-timer" id="gameTimer">03:00</div>
        <div class="game-score" id="gameScore">åˆ†æ•¸: 0</div>
    </div>
    
    <div class="main-area">
        <div class="orders-container" id="ordersContainer"></div>
        <div class="kitchen-area">
            <div class="ingredient-stations-container" id="ingredientStationsContainer"></div>
            <div class="action-stations-container" id="actionStationsContainer"></div>
        </div>
        <div class="task-hint" id="taskHint">æ‹¿å–é£Ÿæé–‹å§‹è£½ä½œæ–™ç†</div>
    </div>
    
    <div class="player-inventory" id="playerInventory"></div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      let gameState = {
        activeSlot: 0,
        inventory: Array(8).fill(null),
        orders: [],
        stations: {},
        players: [],
        status: 'waiting'
      };

      function handleWebsocketMessage(message) {
        switch (message.type) {
          case 'ingredient_picked':
            gameState.inventory[message.slotIndex] = {
              type: message.ingredientType,
              id: message.itemId,
              state: 'raw'
            };
            updateInventory();
            selectNextEmptySlot(); // â˜… é—œéµï¼šè‡ªå‹•é¸æ“‡ä¸‹ä¸€å€‹ç©ºæ§½
            updateTaskHint();
            showToast(`å·²æ‹¿å– ${getItemName(message.ingredientType)}`);
            break;
          // ... å…¶ä»–æ¶ˆæ¯è™•ç†é‚è¼¯ä¿æŒä¸è®Š
        }
      }

      function updateInventory() {
        const slots = playerInventory.querySelectorAll('.inventory-slot');
        gameState.inventory.forEach((item, index) => {
          const slot = slots[index];
          if (!slot) return;
          slot.innerHTML = item 
            ? `<div class="game-item">${getItemSymbol(item.type)}</div><div class="item-label">${getItemName(item.type)}</div>` 
            : 'ç©ºæ§½';
        });
      }
      
      function initStations() {
        const ingredientContainer = document.getElementById('ingredientStationsContainer');
        const actionContainer = document.getElementById('actionStationsContainer');
        ingredientContainer.innerHTML = '';
        actionContainer.innerHTML = '';
        
        const ingredientData = [
          { type: 'ingredient', subtype: 'beef' }, { type: 'ingredient', subtype: 'lettuce' },
          { type: 'ingredient', subtype: 'tomato' }, { type: 'ingredient', subtype: 'onion' },
          { type: 'ingredient', subtype: 'bread' }, { type: 'ingredient', subtype: 'cheese' },
        ];
        
        const actionData = [
          { type: 'cooking', subtype: 'grill', style: 'cook' },
          { type: 'assembly', subtype: 'assembly', style: 'assemble' },
          { type: 'plate', subtype: 'plate', style: 'serve' }
        ];

        ingredientData.forEach(data => ingredientContainer.appendChild(createStation(data.type, data.subtype)));
        actionData.forEach(data => actionContainer.appendChild(createActionStation(data.type, data.subtype, data.style)));
      }

      function createStation(type, subtype) {
        const station = document.createElement('div');
        station.className = 'ingredient-station';
        station.dataset.type = type;
        station.dataset.subtype = subtype;
        station.innerHTML = `
            <div class="station-icon">${getStationSymbol(type, subtype)}</div>
            <div>${getStationName(type, subtype)}</div>`;
        station.addEventListener('click', () => interactWithStation(type, subtype));
        return station;
      }

      function createActionStation(type, subtype, style) {
        const station = document.createElement('div');
        station.className = `action-btn action-btn--${style}`;
        station.dataset.type = type;
        station.dataset.subtype = subtype;
        station.innerHTML = `
            <div class="station-icon">${getStationSymbol(type, subtype)}</div>
            <div class="station-label">${getStationName(type, subtype)}</div>`;
        station.addEventListener('click', () => interactWithStation(type, subtype));
        return station;
      }

      // â˜… æ–°å¢ï¼šè‡ªå‹•é¸æ“‡ä¸‹ä¸€å€‹ç©ºæ§½çš„å‡½æ•¸
      function selectNextEmptySlot() {
        let nextIndex = (gameState.activeSlot + 1) % gameState.inventory.length;
        for (let i = 0; i < gameState.inventory.length; i++) {
            if (gameState.inventory[nextIndex] === null) {
                setActiveSlot(nextIndex);
                return;
            }
            nextIndex = (nextIndex + 1) % gameState.inventory.length;
        }
        showToast("åº«å­˜å·²æ»¿ï¼");
      }

      function setActiveSlot(index) {
          if (index < 0 || index >= gameState.inventory.length) return;
          
          document.querySelectorAll('.inventory-slot').forEach((s, i) => {
              s.classList.toggle('active', i === index);
          });
          gameState.activeSlot = index;
          sendAction('select_slot', { slotIndex: index });
      }

      function updateTaskHint() {
        const taskHint = document.getElementById('taskHint');
        const inventoryIsFull = gameState.inventory.every(item => item !== null);

        if (inventoryIsFull) {
            if (hasAssemblableItems()) {
                taskHint.textContent = "åº«å­˜å·²æ»¿ï¼é»æ“Š [çµ„è£] ä¾†æ¸…å‡ºç©ºé–“ï¼";
            } else if (gameState.inventory.some(item => isCookable(item?.type))) {
                taskHint.textContent = "åº«å­˜å·²æ»¿ï¼é»æ“Š [çƒ¹é£ª] ä¾†è™•ç†é£Ÿæï¼";
            } else {
                taskHint.textContent = "åº«å­˜å·²æ»¿ï¼è«‹è™•ç†æˆ–å‚³éç‰©å“ï¼";
            }
            return;
        }
        
        const hasCompleteDish = gameState.inventory.some(item => item && isCompleteDish(item.type));
        if (hasCompleteDish) {
          taskHint.textContent = 'æ–™ç†å·²å®Œæˆï¼é»æ“Š [ä¸Šèœ] é€é¤ï¼';
        } else if (hasAssemblableItems()) {
          taskHint.textContent = 'å¯ä»¥çµ„è£æ¼¢å ¡äº†ï¼é»æ“Š [çµ„è£]';
        } else if (gameState.inventory.some(item => item && isCookable(item.type))) {
            taskHint.textContent = 'å‰å¾€ [çƒ¹é£ª] è™•ç†é£Ÿæ';
        } else if (gameState.orders && gameState.orders.length > 0) {
          taskHint.textContent = `æ‹¿å–é£Ÿæè£½ä½œ ${getRecipeName(gameState.orders[0].recipe)}`;
        } else {
          taskHint.textContent = 'ç­‰å¾…æ–°è¨‚å–®...';
        }
      }

      function getStationName(type, subtype) {
        switch (type) {
          case 'cooking': return 'çƒ¹é£ª';
          case 'assembly': return 'çµ„è£';
          case 'plate': return 'ä¸Šèœ';
          case 'ingredient':
            switch (subtype) {
              case 'beef': return 'ç‰›è‚‰';
              case 'lettuce': return 'ç”Ÿèœ';
              case 'tomato': return 'ç•ªèŒ„';
              case 'onion': return 'æ´‹è”¥';
              case 'bread': return 'éºµåŒ…';
              case 'cheese': return 'èµ·å¸';
              default: return subtype;
            }
          default: return type;
        }
      }

      function getStationSymbol(type, subtype) {
        switch (type) {
          case 'cooking': return 'ğŸ”¥';
          case 'assembly': return 'ğŸ”§';
          case 'plate': return 'ğŸ½ï¸';
          case 'ingredient':
            switch (subtype) {
              case 'beef': return 'ğŸ¥©';
              case 'lettuce': return 'ğŸ¥¬';
              case 'tomato': return 'ğŸ…';
              case 'onion': return 'ğŸ§…';
              case 'bread': return 'ğŸ';
              case 'cheese': return 'ğŸ§€';
              default: return 'â“';
            }
          default: return 'â“';
        }
      }

      // åˆå§‹åŒ–éŠæˆ²
      initStations();
      initInventory();
      // ... å…¶ä»–åˆå§‹åŒ–ä»£ç¢¼ ...
    });
  </script>
</body>
</html> 
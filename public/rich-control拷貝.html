<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>大富翁遊戲控制器</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }

        body {
            background-color: #f5f5f5;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            padding: 2rem;
        }

        .controller-container {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            padding: 2rem;
            width: 100%;
            max-width: 600px;
            margin-bottom: 2rem;
        }

        h1 {
            text-align: center;
            color: #5b9df0;
            margin-bottom: 1.5rem;
            font-size: 1.8rem;
        }

        .control-section {
            margin-bottom: 1.5rem;
            padding: 1rem;
            border: 1px solid #eaeaea;
            border-radius: 8px;
        }

        .control-section h2 {
            margin-bottom: 1rem;
            color: #333;
            font-size: 1.2rem;
        }

        .player-select {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-bottom: 1rem;
        }

        .player-btn {
    width: 4rem;
    height: 4rem;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: bold;
    font-size: 1.25rem;
    border: none;
    cursor: pointer;
    transition: transform 0.2s, box-shadow 0.2s;
}
        .player-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .player1 {
    background-color: #5b9df0; /* P1 - Geek Blue */
}
/* .player1.selected 的樣式可以保持，或者讓背景色更深 */
.player1.selected {
    background-color: #4a8cdf; /* 可以用深一點的藍色 */
    box-shadow: 0 0 0 4px rgba(91, 157, 240, 0.4); /* 光暈顏色也可以調整 */
}

.player2 {
    background-color: #9270ca; /* P2 - Golden Purple */
}
.player2.selected {
    background-color: #7d5fb3; /* 深一點的紫色 */
    box-shadow: 0 0 0 4px rgba(146, 112, 202, 0.4);
}

.player3 {
    background-color: #ff544d; /* P3 - Sunset Orange */
}
.player3.selected {
    background-color: #e64840; /* 深一點的紅色/橙色 */
    box-shadow: 0 0 0 4px rgba(255, 84, 77, 0.4);
}

        .direction-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
        }

        .direction-btn {
            padding: 1.2rem 2.5rem;  /* 增加內邊距 */
    font-size: 1.3rem;      /* 增大字體 */
    font-weight: bold;
    color: white;
    border: none;
    border-radius: 30px;    /* 更圓的邊角 */
    cursor: pointer;
    transition: all 0.2s;
        }

        .direction-btn:hover {
            transform: scale(1.05);
        }

        .forward {
            background-color: #0cd8b6;
        }

        .forward:hover {
            background-color: #09b699;
        }

        .backward {
            background-color: #ff544d;
        }

        .backward:hover {
            background-color: #e64840;
        }

        .steps-input {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .steps-input label {
            font-weight: bold;
            color: #333;
        }

        .steps-input input {
            width: 4rem;
            padding: 0.5rem;
            border: 1px solid #ccc;
            border-radius: 4px;
            text-align: center;
            font-size: 1rem;
        }

        .connection-status {
            text-align: center;
            margin-bottom: 1rem;
            padding: 0.5rem;
            border-radius: 4px;
            font-weight: bold;
        }

        .connected {
            background-color: #d4edda;
            color: #155724;
        }

        .disconnected {
            background-color: #f8d7da;
            color: #721c24;
        }

        .connecting {
            background-color: #fff3cd;
            color: #856404;
        }

        .game-info {
            margin-top: 1rem;
            padding: 1rem;
            background-color: #f9f9f9;
            border-radius: 8px;
            border: 1px solid #eaeaea;
        }

        .game-info-title {
            font-weight: bold;
            margin-bottom: 0.5rem;
            color: #333;
        }

        .game-info-content {
            color: #555;
        }

        .position-jump {
            margin-top: 1rem;
        }

        .position-jump select {
            padding: 0.5rem;
            border: 1px solid #ccc;
            border-radius: 4px;
            margin-right: 0.5rem;
        }

        .position-jump button {
            padding: 0.5rem 1rem;
            background-color: #5b9df0;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .position-jump button:hover {
            background-color: #4a8cdf;
        }

        .action-btn {
            padding: 0.8rem 1.5rem;
            font-size: 1rem;
            background-color: #9270ca;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s;
            margin-top: 1rem;
            width: 100%;
        }

        .action-btn:hover {
            background-color: #7d5fb3;
        }

        .connection-status { /* Ensure styles for connected/disconnected/connecting exist */
            text-align: center; margin-bottom: 1rem; padding: 0.5rem;
            border-radius: 4px; font-weight: bold; transition: background-color 0.3s, color 0.3s;
        }
        .connected { background-color: #d4edda; color: #155724; }
        .disconnected { background-color: #f8d7da; color: #721c24; }
        .connecting { background-color: #fff3cd; color: #856404; }
        button:disabled { opacity: 0.6; cursor: not-allowed; transform: none !important; }





 /* 移動控制按鈕容器 (使用 Flexbox) */
 .direction-buttons-large {
            display: flex;
            gap: 1rem; /* 按鈕間距 */
            justify-content: center; /* 水平居中 (如果需要) */
            margin-top: 1rem; /* 與標題的間距 */
        }

        /* 更大的方塊按鈕樣式 */
        .direction-btn-large {
            flex: 1; /* 讓兩個按鈕平分寬度 */
            padding: 1.5rem 1rem; /* 增加內邊距，讓按鈕變大 */
            font-size: 1.2rem; /* 放大字體 */
            font-weight: bold;
            color: white;
            border: none;
            border-radius: 8px; /* 方塊圓角 */
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
        }
        .direction-btn-large:hover {
            transform: scale(1.03); /* 稍微縮小 hover 效果 */
            filter: brightness(90%); /* 懸停時稍微變暗 */
        }
        .forward-large { background-color: #0cd8b6; } /* 保持顏色 */
        .backward-large { background-color: #ff544d; } /* 保持顏色 */

        /* 格子資訊按鈕容器 (使用 Flexbox) */
        .info-buttons-small {
            display: flex;
            gap: 0.8rem; /* 按鈕間距 */
            justify-content: center; /* 居中顯示 */
            margin-top: 1rem; /* 與標題的間距 */
        }

        /* 較小的並排按鈕樣式 */
        .info-btn-small {
            padding: 0.5rem 1rem; /* 減小內邊距 */
            font-size: 0.9rem; /* 減小字體 */
            /* background-color: #9270ca; */ /* 保持原紫色或自訂 */
            /* color: white; */
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s;
            width: auto; /* 讓寬度由內容決定 */
            margin-top: 0; /* 移除原 action-btn 的 margin-top */
        }
        .show-info-small { background-color: #9270ca; color: white; } /* 顯示按鈕顏色 */
        .hide-info-small { background-color: #6c757d; color: white; } /* 關閉按鈕顏色 */

        .info-btn-small:hover {
            filter: brightness(90%);
        }

        /* 移除舊 .action-btn 的特定樣式 (如果不再需要) */
        /* 例如 width: 100%; margin-top: 1rem; */
        /* 如果其他地方還用 .action-btn，保留，只覆蓋需要的 */

         /* 移除 .direction-buttons 和 .direction-btn 的舊樣式 (如果不再用) */
         /* 或者保留，以防萬一，新樣式會覆蓋 */






    </style>
</head>
<body>
    <div class="controller-container">
        <h1>大富翁遊戲控制器</h1>

        <div id="connection-status" class="connection-status disconnected">
            未連接遊戲
        </div>

       
        <!-- ★★★ 修改：應用新的 CSS class ★★★ -->
        <div class="control-section">

<!-- ★★★ 您缺少了這個區塊！ ★★★ -->
<div class="control-section">
    <h2>玩家選擇</h2>
    <div class="player-select">
        <button id="player1-btn" class="player-btn player1 selected">P1</button>
        <button id="player2-btn" class="player-btn player2">P2</button>
        <button id="player3-btn" class="player-btn player3">P3</button>
    </div>
</div>
<!-- ★★★ 缺少結束 ★★★ -->


            <h2>移動控制</h2>
            <div class="direction-buttons-large"> <!-- ★ 使用新的容器 class ★ -->
                <button id="forward-btn" class="direction-btn-large forward-large">前進</button> <!-- ★ 使用新的按鈕 class ★ -->
                <button id="backward-btn" class="direction-btn-large backward-large">後退</button> <!-- ★ 使用新的按鈕 class ★ -->
            </div>
        </div>

         <div class="control-section">
            <!-- <h2>格子資訊</h2> --> <!-- 可以移除 H2 -->
            <div class="info-buttons-small"> <!-- ★ 使用新的容器 class ★ -->
                <button id="show-player-info-btn" class="info-btn-small show-info-small">顯示</button> <!-- ★ 使用新的按鈕 class ★ -->
                <button id="hide-player-info-btn" class="info-btn-small hide-info-small">關閉</button> <!-- ★ 使用新的按鈕 class ★ -->
            </div>
        </div>
        <!-- ★★★ 修改結束 ★★★ -->


 



    </div>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
          const player1Btn = document.getElementById('player1-btn');
          const player2Btn = document.getElementById('player2-btn');
          const player3Btn = document.getElementById('player3-btn');
          const forwardBtn = document.getElementById('forward-btn');
          const backwardBtn = document.getElementById('backward-btn');
          const showPlayerInfoBtn = document.getElementById('show-player-info-btn');
          const hidePlayerInfoBtn = document.getElementById('hide-player-info-btn');
          const connectionStatusDiv = document.getElementById('connection-status');
        
          let selectedPlayer = 1;
          let ws = null;
          let gameIsConnected = false;
          const allControlButtons = document.querySelectorAll('.controller-container button, .controller-container input, .controller-container select');
        
          function connectWebSocket() {
            const wsUrl = `wss://${window.location.host}?clientType=controller`;
            ws = new WebSocket(wsUrl);
        
            ws.onopen = () => {
              setControlsEnabled(false);
              updateConnectionStatusUI();
              sendCommand('getGameState');
            };
        
            ws.onmessage = (event) => {
              const message = JSON.parse(event.data);
              if (message.type === 'gameStateUpdate') {
                updateGameInfo(message.data);
                if (message.data.players) {
                  updatePlayerAvatars(message.data.players);
                }
                if (!gameIsConnected) setControlsEnabled(true);
              }
            };
        
            ws.onclose = () => {
              setControlsEnabled(false);
              updateConnectionStatusUI();
              setTimeout(connectWebSocket, 3000);
            };
          }
        
          function setControlsEnabled(enabled) {
            allControlButtons.forEach(el => el.disabled = !enabled);
            gameIsConnected = enabled;
            updateConnectionStatusUI();
          }
        
          function updateConnectionStatusUI() {
            if (ws && ws.readyState === WebSocket.OPEN && gameIsConnected) {
              connectionStatusDiv.className = 'connection-status connected';
              connectionStatusDiv.textContent = '已連接遊戲';
            } else {
              connectionStatusDiv.className = 'connection-status disconnected';
              connectionStatusDiv.textContent = '未連接遊戲';
            }
          }
        
          function sendCommand(command, params = {}) {
            if (!ws || ws.readyState !== WebSocket.OPEN) return;
            const message = { type: 'controlCommand', command, params };
            ws.send(JSON.stringify(message));
          }
        
          function updateGameInfo(data) {
            if (!data) return;
            selectPlayerUI(data.selectedPlayer || 1, false);
            const disable = data.isMoving || !gameIsConnected;
            forwardBtn.disabled = disable;
            backwardBtn.disabled = disable;
            showPlayerInfoBtn.disabled = disable;
            hidePlayerInfoBtn.disabled = disable;
          }
        
          function updatePlayerAvatars(playersData) {
            const buttons = [player1Btn, player2Btn, player3Btn];
            buttons.forEach((btn, i) => {
              const num = i + 1;
              const avatar = (playersData[num] && playersData[num].avatarUrl || '').trim();
              const current = (btn.dataset.avatarUrl || '').trim();
              if (avatar !== current) {
                if (avatar) {
                  btn.innerHTML = `<img src="${avatar}" style="width:100%;height:100%;border-radius:50%;object-fit:cover;">`;
                  btn.dataset.avatarUrl = avatar;
                } else {
                  btn.innerHTML = `P${num}`;
                  delete btn.dataset.avatarUrl;
                }
              }
            });
          }
        
          function selectPlayerUI(num, send = true) {
            selectedPlayer = num;
            player1Btn.classList.toggle('selected', num === 1);
            player2Btn.classList.toggle('selected', num === 2);
            player3Btn.classList.toggle('selected', num === 3);
            if (send) sendCommand('selectPlayer', { player: num });
          }
        
          function movePlayer(direction) {
            sendCommand('movePlayer', { player: selectedPlayer, direction, steps: 1 });
          }
        
          showPlayerInfoBtn.addEventListener('click', () => {
            sendCommand('showPlayerInfo', { player: selectedPlayer });
          });
        
          hidePlayerInfoBtn.addEventListener('click', () => {
            sendCommand('hidePlayerInfo');
          });
        
          player1Btn.addEventListener('click', () => selectPlayerUI(1, true));
          player2Btn.addEventListener('click', () => selectPlayerUI(2, true));
          player3Btn.addEventListener('click', () => selectPlayerUI(3, true));
          forwardBtn.addEventListener('click', () => movePlayer('forward'));
          backwardBtn.addEventListener('click', () => movePlayer('backward'));
        
          connectWebSocket();
        });
        </script>
        

</body>
</html>
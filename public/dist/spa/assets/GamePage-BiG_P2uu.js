import{Q as V,a as O}from"./QCard--nenqCWk.js";import{r as t,a as g,z as G,m as K,E as Z,$ as F,_ as l,a1 as $,a7 as j,a3 as i,Z as S,a2 as D,aa as f,a8 as M,a6 as J,a0 as A,ab as ee,ac as te,W as ae}from"./index-CfL1QsU9.js";import{Q as oe}from"./QPage-DDqIYTdW.js";import{api as se}from"./axios-BCE00Hlk.js";import{u as re}from"./use-quasar-Bbgm9Wxw.js";import{P as x}from"./PetDisplay-CIBAApVR.js";import ne from"./Box3-D33A2cDj.js";import le from"./Idle-DsbNMuy-.js";import ie from"./explosion-Y5bmNw69.js";import ue from"./Basic Charakter Spritesheet-face-DGcq_MBM.js";import ce from"./Basic Charakter Spritesheet-back-B9rVEyHH.js";import pe from"./Basic Charakter Spritesheet-left-CGJoGvDD.js";import me from"./Basic Charakter Spritesheet-righ-BUuq8Otu.js";import{_ as de}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./use-dark-C0VTZI1L.js";import"./index-Dq7h7Pqt.js";const fe={class:"text-h6"},ve={key:0,style:{color:"#ff69b4"}},he={key:1},ye={class:"absolute-bottom text-center q-pa-md"},_=5,U=2,we={__name:"GamePage",setup(ge){const I=re(),W=t("我的寵物"),u=t([]),r=t({name:"載入中...",color:"#ccc"}),H=t(!0),c=t(50),p=t(150),s=t({ArrowUp:!1,ArrowDown:!1,ArrowLeft:!1,ArrowRight:!1}),k=t(!1),L=t(130),E=t(150),v=t([]);let X=0;const m=t(window.innerWidth/2),d=t(window.innerHeight/2),h=t("face");let b=null;const C=t(!1),N=g(()=>{switch(h.value){case"face":return ue;case"back":return ce;case"left":return pe;case"right":return me;default:return null}}),Y=g(()=>({position:"absolute",left:`${m.value}px`,top:`${d.value}px`,transition:`all ${U}s linear`,transform:"scale(3)"})),q=g(()=>({position:"absolute",top:`${p.value}px`,left:`${c.value}px`,filter:`drop-shadow(0 0 15px ${r.value.color})`})),z=g(()=>({position:"absolute",top:`${E.value}px`,left:`${L.value}px`,transition:"all 1s ease-in-out",filter:"drop-shadow(0 0 15px skyblue)"}));G([c,p],([e,a])=>{setTimeout(()=>{L.value=e+150,E.value=a},1e3)});function P(){if(C.value)return;C.value=!0;const e=Math.random()*(window.innerWidth-100),a=Math.random()*(window.innerHeight-100),o=e-m.value,n=a-d.value;h.value=o>0?"right":"left",m.value=e,d.value=a,setTimeout(()=>{C.value=!1,n<0?h.value="back":h.value="face"},U*1e3)}function Q(){if(u.value.length===0)return;const e=Math.floor(Math.random()*u.value.length),a=u.value[e];r.value={name:a.state_name,color:a.state_symbol};const o={id:X++,x:Math.random()*(window.innerWidth-128),y:Math.random()*(window.innerHeight-128)};v.value.push(o),setTimeout(()=>{v.value=v.value.filter(n=>n.id!==o.id)},750),I.notify({message:`寵物的心情變成了「${r.value.name}」！`,color:"deep-purple",icon:"sentiment_very_satisfied",position:"top"})}const R=e=>{e.key in s.value&&(e.preventDefault(),s.value[e.key]=!0)},T=e=>{e.key in s.value&&(e.preventDefault(),s.value[e.key]=!1)},B=()=>{s.value.ArrowUp&&(p.value-=_),s.value.ArrowDown&&(p.value+=_),s.value.ArrowLeft&&(c.value-=_),s.value.ArrowRight&&(c.value+=_);const e=32,a=50,o=c.value+e/2,n=p.value+e/2,y={x1:o-a/2,y1:n-a/2,x2:o+a/2,y2:n+a/2},w={x1:m.value,y1:d.value,x2:m.value+48,y2:d.value+32};y.x1<w.x2&&y.x2>w.x1&&y.y1<w.y2&&y.y2>w.y1?k.value=!0:k.value=!1,requestAnimationFrame(B)};return K(async()=>{P(),b=setInterval(P,3e3),window.addEventListener("keydown",R),window.addEventListener("keyup",T),B();try{const e=await se.get("/api/pet/states");u.value=e.data,u.value.length>0?Q():r.value={name:"沒有可用狀態",color:"#ccc"}}catch(e){console.error("獲取寵物狀態列表失敗:",e),r.value={name:"讀取狀態失敗 :(",color:"red"},I.notify({type:"negative",message:"無法從伺服器讀取寵物狀態！"})}finally{H.value=!1}}),Z(()=>{b&&clearInterval(b),window.removeEventListener("keydown",R),window.removeEventListener("keyup",T)}),(e,a)=>(l(),F(oe,{class:"q-pa-md game-area"},{default:$(()=>[N.value?(l(),F(x,{key:0,spriteSheet:N.value,frameWidth:48,frameHeight:32,totalFrames:4,animationDuration:"0.5s",style:f(Y.value)},null,8,["spriteSheet","style"])):j("",!0),i(V,{class:"q-mb-md text-center",style:{"max-width":"400px",margin:"0 auto"},flat:"",bordered:""},{default:$(()=>[i(O,null,{default:$(()=>[D("div",fe,[k.value?(l(),S("span",ve,M(W.value)+" - 抓到了! 🎉",1)):(l(),S("span",he,[J(M(W.value)+" - ",1),D("span",{style:f({color:r.value.color})},M(r.value.name),5)]))])]),_:1})]),_:1}),i(x,{spriteSheet:A(ne),frameWidth:32,frameHeight:32,totalFrames:4,style:f(q.value)},null,8,["spriteSheet","style"]),i(x,{spriteSheet:A(le),frameWidth:32,frameHeight:32,totalFrames:10,style:f(z.value)},null,8,["spriteSheet","style"]),(l(!0),S(ee,null,te(v.value,o=>(l(),S("div",{key:o.id},[i(x,{spriteSheet:A(ie),frameWidth:32,frameHeight:32,totalFrames:15,loop:!1,animationDuration:"0.75s",style:f({position:"absolute",top:`${o.y}px`,left:`${o.x}px`,transform:"scale(4)"})},null,8,["spriteSheet","style"])]))),128)),D("div",ye,[i(ae,{color:"primary",size:"lg",push:"",label:"改變狀態",icon:"shuffle",onClick:Q,loading:H.value},null,8,["loading"])])]),_:1}))}},Re=de(we,[["__scopeId","data-v-bd7b8b31"]]);export{Re as default};

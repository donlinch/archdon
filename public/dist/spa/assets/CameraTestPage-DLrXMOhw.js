import{r as y,D as v,a as q,m as J,A as ee,$ as te,_ as h,a1 as ae,a2 as n,Z as b,a7 as R,a3 as j,a8 as oe,ab as B,ac as F,aa as S,a0 as ne,W as re}from"./index---0Ru15f.js";import{Q as ie}from"./QPage-ClzyyhNB.js";import{u as se}from"./use-quasar-CyfJr-rY.js";import{n as le}from"./index-J1xnI5EH.js";import{P as ce}from"./PetDisplay-Bp0exty4.js";import w from"./Basic Charakter Spritesheet-face-DGcq_MBM.js";import me from"./Basic Charakter Spritesheet-left-CGJoGvDD.js";import pe from"./Basic Charakter Spritesheet-righ-BUuq8Otu.js";import ue from"./Basic Charakter Spritesheet-back-B9rVEyHH.js";import{_ as de}from"./_plugin-vue_export-helper-DlAUqK2U.js";const fe={key:0,class:"speech-bubble"},ye={key:0,class:"mobile-controls-container q-mt-md"},ve={class:"action-button-zone"},he={class:"minimap-container q-mt-md"},we={class:"minimap-world"},I=1e3,U=1e3,l=.2,xe=Object.assign({name:"CameraTestPage"},{__name:"CameraTestPage",setup(ke){const z=se(),d=y(null),D=y(null),_=y(null),x=y(null),r=v({x:0,y:0,zoom:1}),i=v({x:150,y:150}),o=v({baseSpeed:.2,currentSpeed:.3,maxSpeed:1.5,acceleration:.2,direction:null}),k=y(!1);let f=null;const p=y(w),c=v({ArrowLeft:!1,ArrowRight:!1,ArrowUp:!1,ArrowDown:!1}),u=v({visible:!1,message:"",timer:null});function O(e){const a=[{x:50,y:50},{x:250,y:100},{x:400,y:200},{x:100,y:300},{x:300,y:350}][e-1]||{x:0,y:0};return{left:`${a.x}px`,top:`${a.y}px`}}function X(e){const a=[{x:50,y:50},{x:250,y:100},{x:400,y:200},{x:100,y:300},{x:300,y:350}][e-1]||{x:0,y:0};return{left:`${a.x*l}px`,top:`${a.y*l}px`}}const Y=q(()=>({left:`${i.x*l}px`,top:`${i.y*l}px`})),K=q(()=>{if(!d.value)return{};const e=d.value.clientWidth,t=d.value.clientHeight,a=-r.x,s=-r.y,$=a*l,M=s*l,L=e/r.zoom*l,P=t/r.zoom*l;return{left:`${$}px`,top:`${M}px`,width:`${L}px`,height:`${P}px`}});function A(e){const t=e.currentTarget.getBoundingClientRect(),a=(e.clientX-t.left)/l,s=(e.clientY-t.top)/l;E(a,s),C()}function E(e,t){i.x=Math.max(0,Math.min(I,e)),i.y=Math.max(0,Math.min(U,t))}function m(e){switch(o.direction=e,e){case"left":p.value=me;break;case"right":p.value=pe;break;case"up":p.value=ue;break;case"down":p.value=w;break}k.value||(k.value=!0,Q())}function W(){if(o.direction){o.currentSpeed=Math.min(o.maxSpeed,o.currentSpeed+o.acceleration);let e=i.x,t=i.y;switch(o.direction){case"left":e-=o.currentSpeed;break;case"right":e+=o.currentSpeed;break;case"up":t-=o.currentSpeed;break;case"down":t+=o.currentSpeed;break}E(e,t),C()}else{o.currentSpeed=o.baseSpeed,k.value=!1;return}f=requestAnimationFrame(W)}function Q(){f&&cancelAnimationFrame(f),f=requestAnimationFrame(W)}function g(){f&&(cancelAnimationFrame(f),f=null),k.value=!1,o.currentSpeed=o.baseSpeed}function H(e){if(["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"].includes(e.key))switch(c[e.key]=!0,e.key){case"ArrowLeft":m("left");break;case"ArrowRight":m("right");break;case"ArrowUp":m("up");break;case"ArrowDown":m("down");break}}function T(e){["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"].includes(e.key)&&(c[e.key]=!1),Object.values(c).some(a=>a)?c.ArrowLeft?m("left"):c.ArrowRight?m("right"):c.ArrowUp?m("up"):c.ArrowDown&&m("down"):(o.direction=null,p.value=w,g())}function C(){if(!d.value)return;const e=d.value.clientWidth,t=d.value.clientHeight;let a=-i.x+e/2,s=-i.y+t/2;const $=0,M=0,L=e-I,P=t-U;a=Math.min($,Math.max(L*r.zoom,a)),s=Math.min(M,Math.max(P*r.zoom,s)),r.x=a,r.y=s,N()}function G(){r.zoom=1,i.x=150,i.y=150,p.value=w,o.direction=null,o.currentSpeed=o.baseSpeed,g(),Object.keys(c).forEach(e=>{c[e]=!1}),C()}function N(){_.value&&(_.value.style.transform=`translate(${r.x}px, ${r.y}px) scale(${r.zoom})`,x.value&&(x.value.style.left=`${i.x}px`,x.value.style.top=`${i.y}px`))}function V(){u.message="HI",u.visible=!0,u.timer&&clearTimeout(u.timer),u.timer=setTimeout(()=>{u.visible=!1},2e3)}function Z(){const e={zone:D.value,mode:"static",position:{left:"50%",top:"50%"},color:"blue",size:100},t=le.create(e);t.on("move",(a,s)=>{s.direction&&m(s.direction.angle)}),t.on("end",()=>{o.direction=null,p.value=w,g()})}return J(()=>{G(),window.addEventListener("keydown",H),window.addEventListener("keyup",T),z.platform.is.mobile&&Z();const e=document.querySelector(".minimap-world");e&&e.addEventListener("click",A)}),ee(()=>{window.removeEventListener("keydown",H),window.removeEventListener("keyup",T),g();const e=document.querySelector(".minimap-world");e&&e.removeEventListener("click",A)}),(e,t)=>(h(),te(ie,{class:"flex flex-center column"},{default:ae(()=>[n("div",{class:"camera-test-container q-mt-lg",ref_key:"cameraContainer",ref:d},[n("div",{class:"game-world",ref_key:"gameWorld",ref:_},[n("div",{class:"player",ref_key:"player",ref:x},[u.visible?(h(),b("div",fe,oe(u.message),1)):R("",!0),j(ce,{spriteSheet:p.value,frameWidth:48,frameHeight:38,totalFrames:4,animationDuration:"1s",scale:2},null,8,["spriteSheet"])],512),(h(),b(B,null,F(5,a=>n("div",{class:"obstacle",key:a,style:S(O(a))},null,4)),64))],512)],512),ne(z).platform.is.mobile?(h(),b("div",ye,[n("div",{ref_key:"joystickZone",ref:D,class:"joystick-zone"},null,512),n("div",ve,[j(re,{round:"",color:"red",icon:"campaign",onClick:V,size:"lg",push:""})])])):R("",!0),n("div",he,[n("div",{class:"minimap",onClick:A},[n("div",we,[(h(),b(B,null,F(5,a=>n("div",{class:"minimap-obstacle",key:a,style:S(X(a))},null,4)),64)),n("div",{class:"minimap-player",style:S(Y.value)},null,4),n("div",{class:"viewport-rect",style:S(K.value)},null,4)])]),t[0]||(t[0]=n("p",{class:"text-caption text-grey-8 q-mt-xs"},"地圖全貌 (點擊可移動角色)",-1))])]),_:1}))}}),ze=de(xe,[["__scopeId","data-v-dc12fd82"]]);export{ze as default};

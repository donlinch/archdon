import{$ as I,r as o,a as h}from"./index-CmMiapgT.js";const b=I("auth",()=>{const t=o(null),l=o(null),r=o("未登入"),a=o("https://cdn.quasar.dev/img/boy-avatar.png"),n=o(!1),u=o(null),v=h(()=>!!t.value&&!!l.value);function d(){console.log("Initializing authentication state from localStorage..."),n.value=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1";const e=localStorage.getItem("boxCurrentUserId");if(e){const c=localStorage.getItem(`boxUserToken_${e}`),g=localStorage.getItem("boxCurrentUsername"),m=localStorage.getItem("boxCurrentDisplayName")||g,s=localStorage.getItem("boxCurrentUserAvatar"),S=localStorage.getItem("boxCurrentUserRoleName");c&&g?(t.value=c,l.value=e,u.value=S,console.log("=== User Name Debug ==="),console.log("Raw username from localStorage:",g),console.log("Raw displayName from localStorage:",localStorage.getItem("boxCurrentDisplayName")),console.log("Final display name being used:",m),r.value=m,s&&(n.value&&s.startsWith("/")?(a.value=`http://localhost:3000${s}`,console.log(`AuthStore: Fixed avatar URL to: ${a.value}`)):a.value=s),console.log(`AuthStore: User ${r.value} is logged in.`),n.value&&c.startsWith("dev_")&&console.log("AuthStore: Using development mode authentication.")):(console.log("AuthStore: Token not found, clearing stale auth data."),i())}else console.log("AuthStore: No user ID found in localStorage.")}function i(){console.log("AuthStore: Logging out and clearing auth state.");const e=localStorage.getItem("boxCurrentUserId");e&&localStorage.removeItem(`boxUserToken_${e}`),localStorage.removeItem("boxCurrentUserId"),localStorage.removeItem("boxCurrentUserAvatar"),localStorage.removeItem("boxCurrentUsername"),localStorage.removeItem("boxCurrentDisplayName"),localStorage.removeItem("boxCurrentUserRoleName"),t.value=null,l.value=null,r.value="未登入",a.value="https://cdn.quasar.dev/img/boy-avatar.png",u.value=null}return{token:t,userId:l,username:r,avatar:a,isDev:n,roleName:u,isLoggedIn:v,initializeAuth:d,logout:i}});export{b as u};

import{Q as O,a as V}from"./QCard-DEhKlL0F.js";import{r as t,a as S,y as G,m as K,z as J,G as U,F as l,I as D,O as j,K as i,E as g,J as M,S as f,P as $,N as Z,H as A,T as ee,U as te,C as ae}from"./index-CmMiapgT.js";import{Q as oe}from"./QPage-B2LSk3h5.js";import{api as se}from"./axios-BCE00Hlk.js";import{u as re}from"./use-quasar-DByhWKhR.js";import{P as x}from"./PetDisplay-oSpWb1-V.js";import ne from"./Box3-D33A2cDj.js";import le from"./Idle-DsbNMuy-.js";import ie from"./explosion-Y5bmNw69.js";import ue from"./Basic Charakter Spritesheet-face-DGcq_MBM.js";import ce from"./Basic Charakter Spritesheet-back-B9rVEyHH.js";import pe from"./Basic Charakter Spritesheet-left-CGJoGvDD.js";import me from"./Basic Charakter Spritesheet-righ-BUuq8Otu.js";import{_ as de}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./use-dark-CBHtK-Vo.js";import"./index-Dq7h7Pqt.js";const fe={class:"text-h6"},ve={key:0,style:{color:"#ff69b4"}},he={key:1},ye={class:"absolute-bottom text-center q-pa-md"},_=5,B=2,we={__name:"GamePage",setup(Se){const I=re(),H=t("我的寵物"),u=t([]),r=t({name:"載入中...",color:"#ccc"}),L=t(!0),c=t(50),p=t(150),s=t({ArrowUp:!1,ArrowDown:!1,ArrowLeft:!1,ArrowRight:!1}),k=t(!1),N=t(130),W=t(150),v=t([]);let X=0;const m=t(window.innerWidth/2),d=t(window.innerHeight/2),h=t("face");let b=null;const C=t(!1),E=S(()=>{switch(h.value){case"face":return ue;case"back":return ce;case"left":return pe;case"right":return me;default:return null}}),Y=S(()=>({position:"absolute",left:`${m.value}px`,top:`${d.value}px`,transition:`all ${B}s linear`,transform:"scale(3)"})),q=S(()=>({position:"absolute",top:`${p.value}px`,left:`${c.value}px`,filter:`drop-shadow(0 0 15px ${r.value.color})`})),z=S(()=>({position:"absolute",top:`${W.value}px`,left:`${N.value}px`,transition:"all 1s ease-in-out",filter:"drop-shadow(0 0 15px skyblue)"}));G([c,p],([e,a])=>{setTimeout(()=>{N.value=e+150,W.value=a},1e3)});function P(){if(C.value)return;C.value=!0;const e=Math.random()*(window.innerWidth-100),a=Math.random()*(window.innerHeight-100),o=e-m.value,n=a-d.value;h.value=o>0?"right":"left",m.value=e,d.value=a,setTimeout(()=>{C.value=!1,n<0?h.value="back":h.value="face"},B*1e3)}function T(){if(u.value.length===0)return;const e=Math.floor(Math.random()*u.value.length),a=u.value[e];r.value={name:a.state_name,color:a.state_symbol};const o={id:X++,x:Math.random()*(window.innerWidth-128),y:Math.random()*(window.innerHeight-128)};v.value.push(o),setTimeout(()=>{v.value=v.value.filter(n=>n.id!==o.id)},750),I.notify({message:`寵物的心情變成了「${r.value.name}」！`,color:"deep-purple",icon:"sentiment_very_satisfied",position:"top"})}const F=e=>{e.key in s.value&&(e.preventDefault(),s.value[e.key]=!0)},Q=e=>{e.key in s.value&&(e.preventDefault(),s.value[e.key]=!1)},R=()=>{s.value.ArrowUp&&(p.value-=_),s.value.ArrowDown&&(p.value+=_),s.value.ArrowLeft&&(c.value-=_),s.value.ArrowRight&&(c.value+=_);const e=32,a=50,o=c.value+e/2,n=p.value+e/2,y={x1:o-a/2,y1:n-a/2,x2:o+a/2,y2:n+a/2},w={x1:m.value,y1:d.value,x2:m.value+48,y2:d.value+32};y.x1<w.x2&&y.x2>w.x1&&y.y1<w.y2&&y.y2>w.y1?k.value=!0:k.value=!1,requestAnimationFrame(R)};return K(async()=>{P(),b=setInterval(P,3e3),window.addEventListener("keydown",F),window.addEventListener("keyup",Q),R();try{const e=await se.get("/api/pet/states");u.value=e.data,u.value.length>0?T():r.value={name:"沒有可用狀態",color:"#ccc"}}catch(e){console.error("獲取寵物狀態列表失敗:",e),r.value={name:"讀取狀態失敗 :(",color:"red"},I.notify({type:"negative",message:"無法從伺服器讀取寵物狀態！"})}finally{L.value=!1}}),J(()=>{b&&clearInterval(b),window.removeEventListener("keydown",F),window.removeEventListener("keyup",Q)}),(e,a)=>(l(),U(oe,{class:"q-pa-md game-area"},{default:D(()=>[E.value?(l(),U(x,{key:0,spriteSheet:E.value,frameWidth:48,frameHeight:32,totalFrames:4,animationDuration:"0.5s",style:f(Y.value)},null,8,["spriteSheet","style"])):j("",!0),i(O,{class:"q-mb-md text-center",style:{"max-width":"400px",margin:"0 auto"},flat:"",bordered:""},{default:D(()=>[i(V,null,{default:D(()=>[M("div",fe,[k.value?(l(),g("span",ve,$(H.value)+" - 抓到了! 🎉",1)):(l(),g("span",he,[Z($(H.value)+" - ",1),M("span",{style:f({color:r.value.color})},$(r.value.name),5)]))])]),_:1})]),_:1}),i(x,{spriteSheet:A(ne),frameWidth:32,frameHeight:32,totalFrames:4,style:f(q.value)},null,8,["spriteSheet","style"]),i(x,{spriteSheet:A(le),frameWidth:32,frameHeight:32,totalFrames:10,style:f(z.value)},null,8,["spriteSheet","style"]),(l(!0),g(ee,null,te(v.value,o=>(l(),g("div",{key:o.id},[i(x,{spriteSheet:A(ie),frameWidth:32,frameHeight:32,totalFrames:15,loop:!1,animationDuration:"0.75s",style:f({position:"absolute",top:`${o.y}px`,left:`${o.x}px`,transform:"scale(4)"})},null,8,["spriteSheet","style"])]))),128)),M("div",ye,[i(ae,{color:"primary",size:"lg",push:"",label:"改變狀態",icon:"shuffle",onClick:T,loading:L.value},null,8,["loading"])])]),_:1}))}},Fe=de(we,[["__scopeId","data-v-bd7b8b31"]]);export{Fe as default};

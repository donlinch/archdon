import{c as D,g as E,i as me,e as T,l as ne,a as c,h as f,b as N,p as J,d as ve,r as _,u as ge,f as be,t as R,j as Y,s as H,Q as ae,o as he,k as ye,m as le,v as xe,n as we,q as _e,w as Se,x as O,y as W,z as pe,A as se,B as qe,C as L,D as ke,E as G,F as z,G as F,H as A,I as V,J as S,K as k,L as Ce,M as j,N as Z,O as re,P as K,R as Be}from"./index-CmMiapgT.js";import{u as Ve,a as $e,b as Ie,c as Ae,Q as ee}from"./selection-CtyWBfa2.js";import{u as ze,a as Pe}from"./use-dark-CBHtK-Vo.js";import{g as M,Q as Re,a as te,u as Le,b as De,c as Qe,C as Fe}from"./ClosePopup-l2HUwV2O.js";import Ee from"./eat-logo-word-rguyzZIN.js";import Ue from"./SunnyYummy-CJFbYPjp.js";import{u as ie}from"./auth-store-4AMB3tMM.js";import{u as ue}from"./use-quasar-DByhWKhR.js";import{_ as ce}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{a as Oe}from"./index-Dq7h7Pqt.js";const oe=D({name:"QPageContainer",setup(e,{slots:r}){const{proxy:{$q:t}}=E(),a=me(ne,T);if(a===T)return console.error("QPageContainer needs to be child of QLayout"),T;J(ve,!0);const i=c(()=>{const l={};return a.header.space===!0&&(l.paddingTop=`${a.header.size}px`),a.right.space===!0&&(l[`padding${t.lang.rtl===!0?"Left":"Right"}`]=`${a.right.size}px`),a.footer.space===!0&&(l.paddingBottom=`${a.footer.size}px`),a.left.space===!0&&(l[`padding${t.lang.rtl===!0?"Right":"Left"}`]=`${a.left.size}px`),l});return()=>f("div",{class:"q-page-container",style:i.value},N(r.default))}});function He(e,r){const t=_(null),a=c(()=>e.disable===!0?null:f("span",{ref:t,class:"no-outline",tabindex:-1}));function i(l){const m=r.value;l?.qAvoidFocus!==!0&&(l?.type.indexOf("key")===0?document.activeElement!==m&&m?.contains(document.activeElement)===!0&&m.focus():t.value!==null&&(l===void 0||m?.contains(l.target)===!0)&&t.value.focus())}return{refocusTargetEl:a,refocusTarget:i}}const Ne={xs:30,sm:35,md:40,lg:50,xl:60},Te={...ze,...ge,...Ve,modelValue:{required:!0,default:null},val:{},trueValue:{default:!0},falseValue:{default:!1},indeterminateValue:{default:null},checkedIcon:String,uncheckedIcon:String,indeterminateIcon:String,toggleOrder:{type:String,validator:e=>e==="tf"||e==="ft"},toggleIndeterminate:Boolean,label:String,leftLabel:Boolean,color:String,keepColor:Boolean,dense:Boolean,disable:Boolean,tabindex:[String,Number]},je=["update:modelValue"];function Me(e,r){const{props:t,slots:a,emit:i,proxy:l}=E(),{$q:m}=l,y=Pe(t,m),x=_(null),{refocusTargetEl:h,refocusTarget:C}=He(t,x),b=be(t,Ne),g=c(()=>t.val!==void 0&&Array.isArray(t.modelValue)),n=c(()=>{const u=R(t.val);return g.value===!0?t.modelValue.findIndex(P=>R(P)===u):-1}),s=c(()=>g.value===!0?n.value!==-1:R(t.modelValue)===R(t.trueValue)),p=c(()=>g.value===!0?n.value===-1:R(t.modelValue)===R(t.falseValue)),$=c(()=>s.value===!1&&p.value===!1),I=c(()=>t.disable===!0?-1:t.tabindex||0),B=c(()=>`q-${e} cursor-pointer no-outline row inline no-wrap items-center`+(t.disable===!0?" disabled":"")+(y.value===!0?` q-${e}--dark`:"")+(t.dense===!0?` q-${e}--dense`:"")+(t.leftLabel===!0?" reverse":"")),d=c(()=>{const u=s.value===!0?"truthy":p.value===!0?"falsy":"indet",P=t.color!==void 0&&(t.keepColor===!0||p.value!==!0)?` text-${t.color}`:"";return`q-${e}__inner relative-position non-selectable q-${e}__inner--${u}${P}`}),o=c(()=>{const u={type:"checkbox"};return t.name!==void 0&&Object.assign(u,{".checked":s.value,"^checked":s.value===!0?"checked":void 0,name:t.name,value:g.value===!0?t.val:t.trueValue}),u}),v=$e(o),q=c(()=>{const u={tabindex:I.value,role:"checkbox","aria-label":t.label,"aria-checked":$.value===!0?"mixed":s.value===!0?"true":"false"};return t.disable===!0&&(u["aria-disabled"]="true"),u});function w(u){u!==void 0&&(H(u),C(u)),t.disable!==!0&&i("update:modelValue",Q(),u)}function Q(){if(g.value===!0){if(s.value===!0){const u=t.modelValue.slice();return u.splice(n.value,1),u}return t.modelValue.concat([t.val])}if(s.value===!0){if(t.toggleOrder!=="ft"||t.toggleIndeterminate===!1)return t.falseValue}else if(p.value===!0){if(t.toggleOrder==="ft"||t.toggleIndeterminate===!1)return t.trueValue}else return t.toggleOrder!=="ft"?t.trueValue:t.falseValue;return t.indeterminateValue}function U(u){(u.keyCode===13||u.keyCode===32)&&H(u)}function de(u){(u.keyCode===13||u.keyCode===32)&&w(u)}const fe=r(s,$);return Object.assign(l,{toggle:w}),()=>{const u=fe();t.disable!==!0&&v(u,"unshift",` q-${e}__native absolute q-ma-none q-pa-none`);const P=[f("div",{class:d.value,style:b.value,"aria-hidden":"true"},u)];h.value!==null&&P.push(h.value);const X=t.label!==void 0?Y(a.default,[t.label]):N(a.default);return X!==void 0&&P.push(f("div",{class:`q-${e}__label q-anchor--skip`},X)),f("div",{ref:x,class:B.value,...q.value,onClick:w,onKeydown:U,onKeyup:de},P)}}const We=()=>f("div",{key:"svg",class:"q-checkbox__bg absolute"},[f("svg",{class:"q-checkbox__svg fit absolute-full",viewBox:"0 0 24 24"},[f("path",{class:"q-checkbox__truthy",fill:"none",d:"M1.73,12.91 8.1,19.28 22.79,4.59"}),f("path",{class:"q-checkbox__indet",d:"M4,14H20V10H4"})])]),Ge=D({name:"QCheckbox",props:Te,emits:je,setup(e){const r=We();function t(a,i){const l=c(()=>(a.value===!0?e.checkedIcon:i.value===!0?e.indeterminateIcon:e.uncheckedIcon)||null);return()=>l.value!==null?[f("div",{key:"icon",class:"q-checkbox__icon-container absolute-full flex flex-center no-wrap"},[f(ae,{class:"q-checkbox__icon",name:l.value})])]:[r]}return Me("checkbox",t)}}),Ke=D({name:"QForm",props:{autofocus:Boolean,noErrorFocus:Boolean,noResetFocus:Boolean,greedy:Boolean,onSubmit:Function},emits:["reset","validationSuccess","validationError"],setup(e,{slots:r,emit:t}){const a=E(),i=_(null);let l=0;const m=[];function y(n){const s=typeof n=="boolean"?n:e.noErrorFocus!==!0,p=++l,$=(d,o)=>{t(`validation${d===!0?"Success":"Error"}`,o)},I=d=>{const o=d.validate();return typeof o.then=="function"?o.then(v=>({valid:v,comp:d}),v=>({valid:!1,comp:d,err:v})):Promise.resolve({valid:o,comp:d})};return(e.greedy===!0?Promise.all(m.map(I)).then(d=>d.filter(o=>o.valid!==!0)):m.reduce((d,o)=>d.then(()=>I(o).then(v=>{if(v.valid===!1)return Promise.reject(v)})),Promise.resolve()).catch(d=>[d])).then(d=>{if(d===void 0||d.length===0)return p===l&&$(!0),!0;if(p===l){const{comp:o,err:v}=d[0];if(v!==void 0&&console.error(v),$(!1,o),s===!0){const q=d.find(({comp:w})=>typeof w.focus=="function"&&xe(w.$)===!1);q!==void 0&&q.comp.focus()}}return!1})}function x(){l++,m.forEach(n=>{typeof n.resetValidation=="function"&&n.resetValidation()})}function h(n){n!==void 0&&H(n);const s=l+1;y().then(p=>{s===l&&p===!0&&(e.onSubmit!==void 0?t("submit",n):n?.target!==void 0&&typeof n.target.submit=="function"&&n.target.submit())})}function C(n){n!==void 0&&H(n),t("reset"),we(()=>{x(),e.autofocus===!0&&e.noResetFocus!==!0&&b()})}function b(){Ie(()=>{if(i.value===null)return;(i.value.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||i.value.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||i.value.querySelector("[autofocus], [data-autofocus]")||Array.prototype.find.call(i.value.querySelectorAll("[tabindex]"),s=>s.tabIndex!==-1))?.focus({preventScroll:!0})})}J(_e,{bindComponent(n){m.push(n)},unbindComponent(n){const s=m.indexOf(n);s!==-1&&m.splice(s,1)}});let g=!1;return he(()=>{g=!0}),ye(()=>{g===!0&&e.autofocus===!0&&b()}),le(()=>{e.autofocus===!0&&b()}),Object.assign(a.proxy,{validate:y,resetValidation:x,submit:h,reset:C,focus:b,getValidationComponents:()=>m}),()=>f("form",{class:"q-form",ref:i,onSubmit:h,onReset:C},N(r.default))}}),Je=D({name:"QLayout",props:{container:Boolean,view:{type:String,default:"hhh lpr fff",validator:e=>/^(h|l)h(h|r) lpr (f|l)f(f|r)$/.test(e.toLowerCase())},onScroll:Function,onScrollHeight:Function,onResize:Function},setup(e,{slots:r,emit:t}){const{proxy:{$q:a}}=E(),i=_(null),l=_(a.screen.height),m=_(e.container===!0?0:a.screen.width),y=_({position:0,direction:"down",inflectionPoint:0}),x=_(0),h=_(Se.value===!0?0:M()),C=c(()=>"q-layout q-layout--"+(e.container===!0?"containerized":"standard")),b=c(()=>e.container===!1?{minHeight:a.screen.height+"px"}:null),g=c(()=>h.value!==0?{[a.lang.rtl===!0?"left":"right"]:`${h.value}px`}:null),n=c(()=>h.value!==0?{[a.lang.rtl===!0?"right":"left"]:0,[a.lang.rtl===!0?"left":"right"]:`-${h.value}px`,width:`calc(100% + ${h.value}px)`}:null);function s(o){if(e.container===!0||document.qScrollPrevented!==!0){const v={position:o.position.top,direction:o.direction,directionChanged:o.directionChanged,inflectionPoint:o.inflectionPoint.top,delta:o.delta.top};y.value=v,e.onScroll!==void 0&&t("scroll",v)}}function p(o){const{height:v,width:q}=o;let w=!1;l.value!==v&&(w=!0,l.value=v,e.onScrollHeight!==void 0&&t("scrollHeight",v),I()),m.value!==q&&(w=!0,m.value=q),w===!0&&e.onResize!==void 0&&t("resize",o)}function $({height:o}){x.value!==o&&(x.value=o,I())}function I(){if(e.container===!0){const o=l.value>x.value?M():0;h.value!==o&&(h.value=o)}}let B=null;const d={instances:{},view:c(()=>e.view),isContainer:c(()=>e.container),rootRef:i,height:l,containerHeight:x,scrollbarWidth:h,totalWidth:c(()=>m.value+h.value),rows:c(()=>{const o=e.view.toLowerCase().split(" ");return{top:o[0].split(""),middle:o[1].split(""),bottom:o[2].split("")}}),header:O({size:0,offset:0,space:!1}),right:O({size:300,offset:0,space:!1}),footer:O({size:0,offset:0,space:!1}),left:O({size:300,offset:0,space:!1}),scroll:y,animate(){B!==null?clearTimeout(B):document.body.classList.add("q-body--layout-animate"),B=setTimeout(()=>{B=null,document.body.classList.remove("q-body--layout-animate")},155)},update(o,v,q){d[o][v]=q}};if(J(ne,d),M()>0){let o=function(){w=null,Q.classList.remove("hide-scrollbar")},v=function(){if(w===null){if(Q.scrollHeight>a.screen.height)return;Q.classList.add("hide-scrollbar")}else clearTimeout(w);w=setTimeout(o,300)},q=function(U){w!==null&&U==="remove"&&(clearTimeout(w),o()),window[`${U}EventListener`]("resize",v)},w=null;const Q=document.body;W(()=>e.container!==!0?"add":"remove",q),e.container!==!0&&q("add"),pe(()=>{q("remove")})}return()=>{const o=Y(r.default,[f(Re,{onScroll:s}),f(te,{onResize:p})]),v=f("div",{class:C.value,style:b.value,ref:e.container===!0?void 0:i,tabindex:-1},o);return e.container===!0?f("div",{class:"q-layout-container overflow-hidden",ref:i},[f(te,{onResize:$}),f("div",{class:"absolute-full",style:g.value},[f("div",{class:"scroll",style:n.value},[v])])]):v}}}),Ye=["top","middle","bottom"],Xe=D({name:"QBadge",props:{color:String,textColor:String,floating:Boolean,transparent:Boolean,multiLine:Boolean,outline:Boolean,rounded:Boolean,label:[Number,String],align:{type:String,validator:e=>Ye.includes(e)}},setup(e,{slots:r}){const t=c(()=>e.align!==void 0?{verticalAlign:e.align}:null),a=c(()=>{const i=e.outline===!0&&e.color||e.textColor;return`q-badge flex inline items-center no-wrap q-badge--${e.multiLine===!0?"multi":"single"}-line`+(e.outline===!0?" q-badge--outline":e.color!==void 0?` bg-${e.color}`:"")+(i!==void 0?` text-${i}`:"")+(e.floating===!0?" q-badge--floating":"")+(e.rounded===!0?" q-badge--rounded":"")+(e.transparent===!0?" q-badge--transparent":"")});return()=>f("div",{class:a.value,style:t.value,role:"status","aria-label":e.label},Y(r.default,e.label!==void 0?[e.label]:[]))}}),Ze=Object.keys(se);function et(e){return Ze.reduce((r,t)=>{const a=e[t];return a!==void 0&&(r[t]=a),r},{})}const tt=D({name:"QBtnDropdown",props:{...se,...Le,modelValue:Boolean,split:Boolean,dropdownIcon:String,contentClass:[Array,String,Object],contentStyle:[Array,String,Object],cover:Boolean,persistent:Boolean,noEscDismiss:Boolean,noRouteDismiss:Boolean,autoClose:Boolean,noRefocus:Boolean,noFocus:Boolean,menuAnchor:{type:String,default:"bottom end"},menuSelf:{type:String,default:"top end"},menuOffset:Array,disableMainBtn:Boolean,disableDropdown:Boolean,noIconAnimation:Boolean,toggleAriaLabel:String},emits:["update:modelValue","click","beforeShow","show","beforeHide","hide"],setup(e,{slots:r,emit:t}){const{proxy:a}=E(),i=_(e.modelValue),l=_(null),m=Ae(),y=c(()=>{const o={"aria-expanded":i.value===!0?"true":"false","aria-haspopup":"true","aria-controls":m.value,"aria-label":e.toggleAriaLabel||a.$q.lang.label[i.value===!0?"collapse":"expand"](e.label)};return(e.disable===!0||e.split===!1&&e.disableMainBtn===!0||e.disableDropdown===!0)&&(o["aria-disabled"]="true"),o}),x=c(()=>"q-btn-dropdown__arrow"+(i.value===!0&&e.noIconAnimation===!1?" rotate-180":"")+(e.split===!1?" q-btn-dropdown__arrow-container":"")),h=c(()=>qe(e)),C=c(()=>et(e));W(()=>e.modelValue,o=>{l.value?.[o?"show":"hide"]()}),W(()=>e.split,d);function b(o){i.value=!0,t("beforeShow",o)}function g(o){t("show",o),t("update:modelValue",!0)}function n(o){i.value=!1,t("beforeHide",o)}function s(o){t("hide",o),t("update:modelValue",!1)}function p(o){t("click",o)}function $(o){ke(o),d(),t("click",o)}function I(o){l.value?.toggle(o)}function B(o){l.value?.show(o)}function d(o){l.value?.hide(o)}return Object.assign(a,{show:B,hide:d,toggle:I}),le(()=>{e.modelValue===!0&&B()}),()=>{const o=[f(ae,{class:x.value,name:e.dropdownIcon||a.$q.iconSet.arrow.dropdown})];return e.disableDropdown!==!0&&o.push(f(De,{ref:l,id:m.value,class:e.contentClass,style:e.contentStyle,cover:e.cover,fit:!0,persistent:e.persistent,noEscDismiss:e.noEscDismiss,noRouteDismiss:e.noRouteDismiss,autoClose:e.autoClose,noFocus:e.noFocus,noRefocus:e.noRefocus,anchor:e.menuAnchor,self:e.menuSelf,offset:e.menuOffset,separateClosePopup:!0,transitionShow:e.transitionShow,transitionHide:e.transitionHide,transitionDuration:e.transitionDuration,onBeforeShow:b,onShow:g,onBeforeHide:n,onHide:s},r.default)),e.split===!1?f(L,{class:"q-btn-dropdown q-btn-dropdown--simple",...C.value,...y.value,disable:e.disable===!0||e.disableMainBtn===!0,noWrap:!0,round:!1,onClick:p},{default:()=>N(r.label,[]).concat(o),loading:r.loading}):f(Qe,{class:"q-btn-dropdown q-btn-dropdown--split no-wrap q-btn-item",rounded:e.rounded,square:e.square,...h.value,glossy:e.glossy,stretch:e.stretch},()=>[f(L,{class:"q-btn-dropdown--current",...C.value,disable:e.disable===!0||e.disableMainBtn===!0,noWrap:!0,round:!1,onClick:$},{default:r.label,loading:r.loading}),f(L,{class:"q-btn-dropdown__arrow-container q-anchor--skip",...y.value,...h.value,disable:e.disable===!0||e.disableDropdown===!0,rounded:e.rounded,color:e.color,textColor:e.textColor,dense:e.dense,size:e.size,padding:e.padding,ripple:e.ripple},()=>o)])}}}),ot={class:"user-status-container"},nt={class:"user-status"},at=["src"],lt={class:"row no-wrap q-pa-md"},st={class:"column items-center"},rt=["src"],it={class:"text-subtitle1 q-mb-xs"},ut={key:1,class:"user-status inactive"},ct=["src"],dt=Object.assign({name:"UserStatus"},{__name:"UserStatus",setup(e){const r=ie(),t=ue(),a=()=>{r.logout(),t.notify({color:"info",message:"您已成功登出",icon:"logout"})};return(i,l)=>(z(),G("div",ot,[A(r).isLoggedIn?(z(),F(tt,{key:0,flat:"",dense:"","no-caps":"",class:"user-btn-dropdown"},{label:V(()=>[S("div",nt,[k(j,{size:"40px"},{default:V(()=>[S("img",{src:A(r).avatar,alt:"User Avatar"},null,8,at)]),_:1})])]),default:V(()=>[S("div",lt,[S("div",st,[k(j,{size:"72px",class:"q-mb-md"},{default:V(()=>[S("img",{src:A(r).avatar,alt:"User Avatar"},null,8,rt)]),_:1}),S("div",it,[Z(K(A(r).username)+" ",1),A(r).roleName?(z(),F(Xe,{key:0,align:"middle",color:"orange"},{default:V(()=>[Z(K(A(r).roleName),1)]),_:1})):re("",!0)]),Ce(k(L,{color:"negative",label:"登出",push:"",size:"sm",onClick:a,class:"q-mt-md",icon:"logout"},null,512),[[Fe]])])])]),_:1})):(z(),G("div",ut,[k(j,{size:"40px"},{default:V(()=>[S("img",{src:A(r).avatar,alt:"User Avatar"},null,8,ct)]),_:1})]))]))}}),ft=ce(dt,[["__scopeId","data-v-3ef7e990"]]),mt={class:"login-container"},vt={class:"login-form-card"},gt={class:"row justify-between items-center q-mt-md"},bt={key:0,class:"text-negative q-mt-sm text-center"},ht={class:"row justify-center q-mt-md"},yt=Object.assign({name:"GameLayout"},{__name:"GameLayout",setup(e){const r=ie(),t=ue(),a=_(""),i=_(""),l=_(!0),m=_(!1),y=_(""),x=c(()=>window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"),h=async()=>{try{m.value=!0,y.value="";const b=await Oe.post(`${x.value?"http://localhost:3000":""}/api/box/users/login`,{username:a.value,password:i.value});if(b.data.success&&b.data.token){const{token:g,user:n}=b.data;if(console.log("從後端收到的 User Data:",n),localStorage.setItem("boxCurrentUserId",n.userId.toString()),localStorage.setItem(`boxUserToken_${n.userId}`,g),localStorage.setItem("boxCurrentUsername",n.username),n.displayName?localStorage.setItem("boxCurrentDisplayName",n.displayName):localStorage.setItem("boxCurrentDisplayName",n.username),n.roleName&&localStorage.setItem("boxCurrentUserRoleName",n.roleName),n.profileImageUrl){let s=n.profileImageUrl;s.startsWith("/")&&(s=`${x.value?"http://localhost:3000":""}${s}`),localStorage.setItem("boxCurrentUserAvatar",s)}else localStorage.setItem("boxCurrentUserAvatar",`${x.value?"http://localhost:3000":""}/images/a01girlmove.gif`);r.initializeAuth(),t.notify({color:"positive",message:"登入成功",icon:"check"})}else throw new Error("登入失敗: 無效的回應格式")}catch(b){b.response?b.response.status===401?y.value="帳號或密碼錯誤":y.value=`登入失敗: ${b.response.data?.error||"伺服器錯誤"}`:b.request?y.value="無法連接到伺服器，請確認後端服務已啟動":y.value=b.message||"發生未知錯誤"}finally{m.value=!1}},C=()=>{x.value?window.location.href="http://localhost:3000/games.html":window.location.href="/game.html"};return(b,g)=>{const n=Be("router-view");return z(),F(Je,{view:"lHh Lpr lFf"},{default:V(()=>[k(ft),A(r).isLoggedIn?(z(),F(oe,{key:0},{default:V(()=>[k(n)]),_:1})):(z(),F(oe,{key:1},{default:V(()=>[S("div",mt,[S("div",vt,[g[3]||(g[3]=S("div",{class:"logo-header"},[S("img",{src:Ee,alt:"Eat Funny Girl Logo",class:"logo-image"}),S("img",{src:Ue,alt:"Sunny Yummy Logo",class:"logo-image"})],-1)),k(Ke,{onSubmit:h,class:"q-gutter-md"},{default:V(()=>[k(ee,{modelValue:a.value,"onUpdate:modelValue":g[0]||(g[0]=s=>a.value=s),label:"使用者名稱",outlined:"",dense:"",rules:[s=>!!s||"請輸入使用者名稱"]},null,8,["modelValue","rules"]),k(ee,{modelValue:i.value,"onUpdate:modelValue":g[1]||(g[1]=s=>i.value=s),label:"密碼",type:"password",outlined:"",dense:"",rules:[s=>!!s||"請輸入密碼"]},null,8,["modelValue","rules"]),S("div",gt,[k(Ge,{modelValue:l.value,"onUpdate:modelValue":g[2]||(g[2]=s=>l.value=s),label:"記住我"},null,8,["modelValue"]),k(L,{type:"submit",color:"primary",label:"登入",loading:m.value},null,8,["loading"])]),y.value?(z(),G("div",bt,K(y.value),1)):re("",!0),S("div",ht,[k(L,{flat:"",color:"secondary",label:"回遊戲頁面",onClick:C,icon:"arrow_back"})])]),_:1})])])]),_:1}))]),_:1})}}}),$t=ce(yt,[["__scopeId","data-v-1f6f8926"]]);export{$t as default};

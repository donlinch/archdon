<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>寵物養成遊戲</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#6366F1',
                        secondary: '#EC4899',
                        neutral: '#1F2937',
                        light: '#F3F4F6',
                        success: '#10B981',
                        warning: '#F59E0B',
                        danger: '#EF4444',
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .pet-container {
                height: 40vh;
            }
            .stat-bar {
                height: 0.75rem;
                transition: width 0.5s ease;
            }
            .btn-action {
                @apply bg-primary hover:bg-primary/80 text-white font-bold py-3 px-4 rounded-full shadow-lg transform hover:scale-105 transition-all duration-300;
            }
            .btn-item {
                @apply bg-light hover:bg-light/80 text-neutral font-bold py-2 px-3 rounded-lg shadow-md transform hover:scale-105 transition-all duration-300;
            }
            .modal {
                opacity: 0;
                visibility: hidden;
                transition: opacity 0.3s ease, visibility 0.3s ease;
            }
            .modal.active {
                opacity: 1;
                visibility: visible;
            }
            .achievement-card {
                transition: all 0.3s ease;
            }
            .achievement-card:hover {
                transform: translateY(-5px);
                box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            }
        }
    </style>
</head>
<body class="bg-gradient-to-b from-indigo-50 to-purple-100 min-h-screen font-sans">
    <!-- 頂部狀態欄 -->
    <header class="bg-white/80 backdrop-blur-sm shadow-md sticky top-0 z-50">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <i class="fa fa-paw text-primary text-xl"></i>
                <h1 class="text-xl font-bold text-neutral">寵物養成</h1>
            </div>
            <div class="flex items-center space-x-4">
                <div class="flex items-center">
                    <i class="fa fa-diamond text-secondary"></i>
                    <span id="diamond-count" class="ml-1 font-bold">25</span>
                </div>
                <div class="flex items-center">
                    <i class="fa fa-clock-o text-warning"></i>
                    <span id="level-count" class="ml-1 font-bold">Lv.1</span>
                </div>
            </div>
        </div>
        
        <!-- 狀態條 -->
        <div class="container mx-auto px-4 py-2 space-y-2">
            <div class="flex justify-between text-sm">
                <span>生命值</span>
                <span id="health-value">85%</span>
            </div>
            <div class="w-full bg-gray-200 rounded-full overflow-hidden">
                <div id="health-bar" class="stat-bar bg-success" style="width: 85%"></div>
            </div>
            
            <div class="flex justify-between text-sm">
                <span>飽食度</span>
                <span id="hunger-value">60%</span>
            </div>
            <div class="w-full bg-gray-200 rounded-full overflow-hidden">
                <div id="hunger-bar" class="stat-bar bg-warning" style="width: 60%"></div>
            </div>
            
            <div class="flex justify-between text-sm">
                <span>心情值</span>
                <span id="mood-value">90%</span>
            </div>
            <div class="w-full bg-gray-200 rounded-full overflow-hidden">
                <div id="mood-bar" class="stat-bar bg-primary" style="width: 90%"></div>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4 py-6">
        <!-- 寵物顯示區域 -->
        <section class="pet-container bg-white/60 backdrop-blur-sm rounded-2xl shadow-lg flex items-center justify-center mb-6 relative overflow-hidden">
            <div id="pet-status" class="absolute top-2 right-2 bg-primary/80 text-white text-xs px-2 py-1 rounded-full">
                快樂
            </div>
            <div class="pet-character relative">
                <img src="https://picsum.photos/seed/pet/200/200" alt="可愛寵物形象" class="w-48 h-48 object-contain transform hover:scale-110 transition-all duration-300">
                <div class="pet-bubble absolute -top-10 left-1/2 transform -translate-x-1/2 bg-white rounded-full px-3 py-1 shadow-md opacity-0 transition-opacity duration-300" id="pet-message">
                    你好呀！
                </div>
            </div>
        </section>
        
        <!-- 成長進度 -->
        <section class="bg-white/60 backdrop-blur-sm rounded-2xl shadow-lg p-4 mb-6">
            <h2 class="text-lg font-bold text-neutral mb-2 flex items-center">
                <i class="fa fa-line-chart text-primary mr-2"></i>成長進度
            </h2>
            <div class="flex justify-between items-center">
                <div class="flex-1 mr-2">
                    <div class="w-full bg-gray-200 rounded-full overflow-hidden">
                        <div id="growth-bar" class="stat-bar bg-secondary" style="width: 45%"></div>
                    </div>
                </div>
                <span class="font-bold text-neutral">45%</span>
            </div>
            <div class="flex justify-between text-xs text-gray-500 mt-1">
                <span>嬰兒期</span>
                <span>少年期</span>
                <span>成年期</span>
            </div>
        </section>
        
        <!-- 主要操作按鈕 -->
        <section class="grid grid-cols-2 gap-4 mb-6">
            <button id="feed-btn" class="btn-action flex flex-col items-center">
                <i class="fa fa-cutlery text-2xl mb-1"></i>
                <span>餵食</span>
            </button>
            <button id="play-btn" class="btn-action flex flex-col items-center">
                <i class="fa fa-gamepad text-2xl mb-1"></i>
                <span>玩耍</span>
            </button>
            <button id="clean-btn" class="btn-action flex flex-col items-center">
                <i class="fa fa-shower text-2xl mb-1"></i>
                <span>清潔</span>
            </button>
            <button id="sleep-btn" class="btn-action flex flex-col items-center">
                <i class="fa fa-moon-o text-2xl mb-1"></i>
                <span>睡覺</span>
            </button>
        </section>
        
        <!-- 物品商店 -->
        <section class="bg-white/60 backdrop-blur-sm rounded-2xl shadow-lg p-4 mb-6">
            <div class="flex justify-between items-center mb-3">
                <h2 class="text-lg font-bold text-neutral flex items-center">
                    <i class="fa fa-shopping-bag text-primary mr-2"></i>物品商店
                </h2>
                <button id="shop-toggle" class="text-primary hover:text-primary/80 text-sm font-medium">
                    查看全部 <i class="fa fa-angle-right ml-1"></i>
                </button>
            </div>
            <div class="grid grid-cols-3 gap-3">
                <div class="bg-white rounded-xl shadow p-2 flex flex-col items-center btn-item" data-item="food">
                    <img src="https://picsum.photos/seed/food1/50/50" alt="高級食物" class="w-12 h-12 object-contain mb-1">
                    <span class="text-xs font-medium">高級食物</span>
                    <div class="flex items-center text-xs text-secondary mt-1">
                        <i class="fa fa-diamond mr-1"></i> 5
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow p-2 flex flex-col items-center btn-item" data-item="toy">
                    <img src="https://picsum.photos/seed/toy1/50/50" alt="玩具球" class="w-12 h-12 object-contain mb-1">
                    <span class="text-xs font-medium">玩具球</span>
                    <div class="flex items-center text-xs text-secondary mt-1">
                        <i class="fa fa-diamond mr-1"></i> 3
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow p-2 flex flex-col items-center btn-item" data-item="shampoo">
                    <img src="https://picsum.photos/seed/bath1/50/50" alt="香波" class="w-12 h-12 object-contain mb-1">
                    <span class="text-xs font-medium">香波</span>
                    <div class="flex items-center text-xs text-secondary mt-1">
                        <i class="fa fa-diamond mr-1"></i> 4
                    </div>
                </div>
            </div>
        </section>
        
        <!-- 任務系統 -->
        <section id="tasks-section" class="bg-white/60 backdrop-blur-sm rounded-2xl shadow-lg p-4 mb-6">
            <h2 class="text-lg font-bold text-neutral mb-3 flex items-center">
                <i class="fa fa-tasks text-primary mr-2"></i>每日任務
            </h2>
            <div class="space-y-2" id="task-list">
                <!-- 任務將由JavaScript動態生成 -->
            </div>
        </section>
        
        <!-- 成就系統 -->
        <section id="achievements-section" class="bg-white/60 backdrop-blur-sm rounded-2xl shadow-lg p-4 mb-6">
            <div class="flex justify-between items-center mb-3">
                <h2 class="text-lg font-bold text-neutral flex items-center">
                    <i class="fa fa-trophy text-yellow-500 mr-2"></i>成就系統
                </h2>
                <span class="text-sm text-gray-500" id="achievements-stats">0/0 已解鎖</span>
            </div>
            <div class="grid grid-cols-2 gap-3" id="achievements-grid">
                <!-- 成就將由JavaScript動態生成 -->
            </div>
        </section>
    </main>

    <!-- 底部導航 -->
    <footer class="bg-white/80 backdrop-blur-sm shadow-lg fixed bottom-0 left-0 right-0">
        <div class="container mx-auto px-4">
            <div class="flex justify-around py-3">
                <a href="#" class="flex flex-col items-center text-primary" data-page="home">
                    <i class="fa fa-home text-xl"></i>
                    <span class="text-xs mt-1">主頁</span>
                </a>
                <a href="#" class="flex flex-col items-center text-gray-500 hover:text-primary transition-colors" data-page="tasks">
                    <i class="fa fa-tasks text-xl"></i>
                    <span class="text-xs mt-1">任務</span>
                </a>
                <a href="#" class="flex flex-col items-center text-gray-500 hover:text-primary transition-colors" data-page="achievements">
                    <i class="fa fa-trophy text-xl"></i>
                    <span class="text-xs mt-1">成就</span>
                </a>
                <a href="#" class="flex flex-col items-center text-gray-500 hover:text-primary transition-colors" data-page="settings">
                    <i class="fa fa-cog text-xl"></i>
                    <span class="text-xs mt-1">設置</span>
                </a>
            </div>
        </div>
    </footer>

    <!-- 模態對話框 -->
    <div id="action-modal" class="modal fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4">
        <div class="bg-white rounded-2xl shadow-xl w-full max-w-md transform transition-all duration-300 scale-95 opacity-0" id="modal-content">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold text-neutral" id="modal-title">餵食</h3>
                    <button id="close-modal" class="text-gray-400 hover:text-gray-500">
                        <i class="fa fa-times text-xl"></i>
                    </button>
                </div>
                <div class="text-center mb-6">
                    <img id="modal-image" src="https://picsum.photos/seed/food1/100/100" alt="高級食物" class="w-24 h-24 object-contain mx-auto mb-2">
                    <p class="text-lg font-medium text-neutral" id="modal-description">使用高級食物可以提高飽食度30點</p>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <button id="cancel-action" class="bg-gray-200 hover:bg-gray-300 text-neutral font-bold py-3 px-4 rounded-full shadow-md">
                        取消
                    </button>
                    <button id="confirm-action" class="bg-primary hover:bg-primary/80 text-white font-bold py-3 px-4 rounded-full shadow-lg">
                        確認使用
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 成就解鎖通知 -->
    <div id="achievement-notification" class="fixed bottom-20 right-4 bg-white rounded-xl shadow-lg p-3 transform translate-x-full transition-transform duration-500 z-50 flex items-center">
        <div class="w-10 h-10 bg-yellow-100 rounded-full flex items-center justify-center mr-3">
            <i class="fa fa-trophy text-yellow-500"></i>
        </div>
        <div>
            <p class="font-bold text-sm" id="achievement-name">成就解鎖!</p>
            <p class="text-xs text-gray-500" id="achievement-desc">獲得新成就</p>
        </div>
    </div>

    <script>
        // 狀態變量
        let stats = {
            health: 85,
            hunger: 60,
            mood: 90,
            growth: 45,
            diamonds: 25
        };
        
        // 玩家等級和經驗
        let playerLevel = 1;
        let playerExperience = 0;
        const experienceToNextLevel = 100;
        
        // 任務定義
        const tasks = [
            {
                id: 1,
                name: "餵食3次",
                description: "給寵物餵食3次",
                type: "counter",
                targetValue: 3,
                currentValue: 0,
                reward: { diamonds: 5 },
                status: "inProgress",
                completed: false
            },
            {
                id: 2,
                name: "玩耍2次",
                description: "和寵物玩耍2次",
                type: "counter",
                targetValue: 2,
                currentValue: 0,
                reward: { diamonds: 3 },
                status: "inProgress",
                completed: false
            },
            {
                id: 3,
                name: "保持滿心情值1小時",
                description: "保持寵物心情值100%持續1小時",
                type: "timed",
                targetTime: 3600,
                currentTime: 0,
                reward: { diamonds: 10 },
                status: "inProgress",
                completed: false,
                isActive: false
            },
            {
                id: 4,
                name: "健康值滿100",
                description: "讓寵物健康值達到100",
                type: "condition",
                reward: { diamonds: 8 },
                status: "notStarted",
                completed: false
            }
        ];
        
        // 成就定義
        const achievements = [
            {
                id: 1,
                name: "初級飼養員",
                description: "成功餵食寵物10次",
                type: "counter",
                target: 10,
                current: 0,
                condition: "feedCount >= 10",
                reward: { diamonds: 10, title: "初級飼養員" },
                unlocked: false,
                secret: false
            },
            {
                id: 2,
                name: "親密好友",
                description: "保持寵物心情值滿狀態累計10分鐘",
                type: "timed",
                target: 600,
                current: 0,
                condition: "maxMoodTime >= 600",
                reward: { diamonds: 20, item: "友誼項圈" },
                unlocked: false,
                secret: false
            },
            {
                id: 3,
                name: "健康專家",
                description: "讓寵物健康值達到100三次",
                type: "counter",
                target: 3,
                current: 0,
                condition: "maxHealthCount >= 3",
                reward: { ability: "healthRegen" },
                unlocked: false,
                secret: false
            },
            {
                id: 4,
                name: "隱藏成就",
                description: "在不被發現的情況下完成特殊操作",
                type: "secret",
                condition: "specialActionCount >= 5 && !discovered",
                reward: { diamonds: 50, title: "潛行大師" },
                unlocked: false,
                secret: true,
                hidden: true
            },
            {
                id: 5,
                name: "收藏家",
                description: "收集所有物品",
                type: "collection",
                target: 3,
                current: 0,
                condition: "collectedItems >= 3",
                reward: { diamonds: 30, specialItem: "彩虹項圈" },
                unlocked: false,
                secret: false
            }
        ];
        
        // 遊戲統計數據
        const gameStats = {
            feedCount: 0,
            playCount: 0,
            cleanCount: 0,
            sleepCount: 0,
            maxHealthCount: 0,
            maxMoodTime: 0,
            specialActionCount: 0,
            discovered: false,
            collectedItems: 0
        };
        
        // 物品數據庫
        const items = {
            "food": { id: "food", name: "高級食物", description: "提高飽食度30點", type: "consumable", price: 5, effect: 30, image: "https://picsum.photos/seed/food1/50/50" },
            "toy": { id: "toy", name: "玩具球", description: "提高心情值20點", type: "consumable", price: 3, effect: 20, image: "https://picsum.photos/seed/toy1/50/50" },
            "shampoo": { id: "shampoo", name: "香波", description: "提高健康值25點", type: "consumable", price: 4, effect: 25, image: "https://picsum.photos/seed/bath1/50/50" }
        };
        
        // 玩家物品清單
        let playerInventory = [];
        
        // 玩家能力列表
        let playerAbilities = [];
        
        // DOM 元素
        const healthBar = document.getElementById('health-bar');
        const healthValue = document.getElementById('health-value');
        const hungerBar = document.getElementById('hunger-bar');
        const hungerValue = document.getElementById('hunger-value');
        const moodBar = document.getElementById('mood-bar');
        const moodValue = document.getElementById('mood-value');
        const growthBar = document.getElementById('growth-bar');
        const diamondCount = document.getElementById('diamond-count');
        const levelCount = document.getElementById('level-count');
        
        const feedBtn = document.getElementById('feed-btn');
        const playBtn = document.getElementById('play-btn');
        const cleanBtn = document.getElementById('clean-btn');
        const sleepBtn = document.getElementById('sleep-btn');
        
        const modal = document.getElementById('action-modal');
        const modalContent = document.getElementById('modal-content');
        const modalTitle = document.getElementById('modal-title');
        const modalDescription = document.getElementById('modal-description');
        const modalImage = document.getElementById('modal-image');
        const closeModal = document.getElementById('close-modal');
        const cancelAction = document.getElementById('cancel-action');
        const confirmAction = document.getElementById('confirm-action');
        
        const petMessage = document.getElementById('pet-message');
        const petStatus = document.getElementById('pet-status');
        
        const taskList = document.getElementById('task-list');
        const achievementsGrid = document.getElementById('achievements-grid');
        const achievementsStats = document.getElementById('achievements-stats');
        
        const achievementNotification = document.getElementById('achievement-notification');
        const achievementName = document.getElementById('achievement-name');
        const achievementDesc = document.getElementById('achievement-desc');
        
        // 頁面導航
        const navLinks = document.querySelectorAll('footer a');
        const mainContent = document.querySelector('main');
        
        // 更新狀態條顯示
        function updateStats() {
            // 確保狀態值在0-100之間
            for (const stat in stats) {
                if (stats[stat] > 100) stats[stat] = 100;
                if (stats[stat] < 0) stats[stat] = 0;
            }
            
            // 更新健康狀態顏色
            let healthColor = 'bg-success';
            if (stats.health < 40) healthColor = 'bg-danger';
            else if (stats.health < 70) healthColor = 'bg-warning';
            
            // 更新DOM
            healthBar.className = `stat-bar ${healthColor}`;
            healthBar.style.width = `${stats.health}%`;
            healthValue.textContent = `${stats.health}%`;
            
            let hungerColor = 'bg-success';
            if (stats.hunger < 40) hungerColor = 'bg-danger';
            else if (stats.hunger < 70) hungerColor = 'bg-warning';
            
            hungerBar.className = `stat-bar ${hungerColor}`;
            hungerBar.style.width = `${stats.hunger}%`;
            hungerValue.textContent = `${stats.hunger}%`;
            
            let moodColor = 'bg-success';
            if (stats.mood < 40) moodColor = 'bg-danger';
            else if (stats.mood < 70) moodColor = 'bg-warning';
            
            moodBar.className = `stat-bar ${moodColor}`;
            moodBar.style.width = `${stats.mood}%`;
            moodValue.textContent = `${stats.mood}%`;
            
            growthBar.style.width = `${stats.growth}%`;
            diamondCount.textContent = stats.diamonds;
            levelCount.textContent = `Lv.${playerLevel}`;
            
            // 更新寵物狀態
            updatePetStatus();
            
            // 檢查條件任務
            checkConditionTasks();
            
            // 處理計時任務（心情值滿時）
            const timedTask = tasks.find(t => t.id === 3 && !t.completed);
            if (timedTask) {
                if (stats.mood >= 100) {
                    updateTask(3, true); // 開始計時
                } else {
                    updateTask(3, false); // 停止計時
                }
            }
            
            // 檢查成就
            checkAchievements();
        }
        
        // 更新寵物狀態顯示
        function updatePetStatus() {
            let status = "快樂";
            let statusColor = "bg-primary/80";
            
            if (stats.health < 40) {
                status = "生病";
                statusColor = "bg-danger/80";
            } else if (stats.health < 70) {
                status = "不舒服";
                statusColor = "bg-warning/80";
            } else if (stats.hunger < 40) {
                status = "飢餓";
                statusColor = "bg-danger/80";
            } else if (stats.hunger < 70) {
                status = "有點餓";
                statusColor = "bg-warning/80";
            } else if (stats.mood < 40) {
                status = "鬱悶";
                statusColor = "bg-danger/80";
            } else if (stats.mood < 70) {
                status = "不開心";
                statusColor = "bg-warning/80";
            }
            
            petStatus.textContent = status;
            petStatus.className = `absolute top-2 right-2 ${statusColor} text-white text-xs px-2 py-1 rounded-full`;
        }
        
        // 顯示寵物消息
        function showPetMessage(message) {
            petMessage.textContent = message;
            petMessage.style.opacity = '1';
            
            setTimeout(() => {
                petMessage.style.opacity = '0';
            }, 2000);
        }
        
        // 顯示模態框
        function showModal(title, description, image, actionCallback) {
            modalTitle.textContent = title;
            modalDescription.textContent = description;
            modalImage.src = image;
            modalImage.alt = title;
            
            // 保存回調函數
            confirmAction.onclick = () => {
                actionCallback();
                hideModal();
            };
            
            // 顯示模態框並添加動畫
            modal.classList.add('active');
            setTimeout(() => {
                modalContent.classList.remove('scale-95', 'opacity-0');
                modalContent.classList.add('scale-100', 'opacity-100');
            }, 10);
        }
        
        // 隱藏模態框
        function hideModal() {
            modalContent.classList.remove('scale-100', 'opacity-100');
            modalContent.classList.add('scale-95', 'opacity-0');
            
            setTimeout(() => {
                modal.classList.remove('active');
            }, 300);
        }
        
        // 更新任務進度
        function updateTask(taskId, value) {
            const task = tasks.find(t => t.id === taskId);
            if (!task || task.completed) return;
            
            if (task.type === 'counter') {
                task.currentValue += value;
                if (task.currentValue >= task.targetValue) {
                    completeTask(task);
                }
            } else if (task.type === 'timed') {
                if (value) { // 開始計時
                    task.isActive = true;
                    task.currentTime += 1;
                    
                    // 更新成就計時
                    const moodAchievement = achievements.find(a => a.id === 2 && !a.unlocked);
                    if (moodAchievement) {
                        moodAchievement.current += 1;
                        saveAchievementsToStorage();
                    }
                } else { // 停止計時
                    task.isActive = false;
                }
                
                if (task.currentTime >= task.targetTime) {
                    completeTask(task);
                }
            } else if (task.type === 'condition') {
                // 條件類型任務需要在其他地方檢查條件
                task.status = 'inProgress';
            }
            
            saveTasksToStorage();
            renderTasks();
        }
        
        // 檢查條件任務
        function checkConditionTasks() {
            const healthTask = tasks.find(t => t.id === 4 && !t.completed);
            if (healthTask && stats.health >= 100) {
                completeTask(healthTask);
                
                // 更新成就
                const healthAchievement = achievements.find(a => a.id === 3 && !a.unlocked);
                if (healthAchievement) {
                    healthAchievement.current += 1;
                    if (healthAchievement.current >= healthAchievement.target) {
                        unlockAchievement(healthAchievement);
                    }
                    saveAchievementsToStorage();
                }
                
                gameStats.maxHealthCount += 1;
                saveGameStatsToStorage();
            }
        }
        
        // 完成任務
        function completeTask(task) {
            task.completed = true;
            task.status = 'completed';
            
            // 觸發任務完成事件
            const event = new CustomEvent('taskCompleted', {
                detail: { task }
            });
            document.dispatchEvent(event);
            
            saveTasksToStorage();
            renderTasks();
        }
        
        // 領取任務獎勵
        function claimTaskReward(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (!task || !task.completed || task.status === 'claimed') return;
            
            // 發放獎勵
            if (task.reward.diamonds) {
                stats.diamonds += task.reward.diamonds;
                updateStats();
                animateDiamondReward(task.reward.diamonds);
            }
            
            task.status = 'claimed';
            saveTasksToStorage();
            renderTasks();
            
            // 顯示獎勵通知
            showPetMessage(`恭喜！你獲得了 ${task.reward.diamonds} 鑽石獎勵！`);
        }
        
        // 鑽石獎勵動畫
        function animateDiamondReward(amount) {
            const diamondIcon = document.createElement('div');
            diamondIcon.className = 'fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-4xl text-secondary animate-bounce';
            diamondIcon.innerHTML = `<i class="fa fa-diamond"></i> +${amount}`;
            document.body.appendChild(diamondIcon);
            
            // 動畫效果
            setTimeout(() => {
                diamondIcon.style.transition = 'all 1s ease-out';
                diamondIcon.style.opacity = '0';
                diamondIcon.style.transform = 'translate(-50%, -150%) scale(0.5)';
                
                setTimeout(() => {
                    document.body.removeChild(diamondIcon);
                }, 1000);
            }, 500);
        }
        
        // 渲染任務列表
        function renderTasks() {
            if (!taskList) return;
            
            // 清空現有任務
            taskList.innerHTML = '';
            
            // 添加所有任務
            tasks.forEach(task => {
                const taskElement = document.createElement('div');
                taskElement.className = `flex items-center p-2 bg-white/80 rounded-lg ${task.completed ? 'border-l-4 border-yellow-400' : ''}`;
                
                let statusClass = 'text-blue-600 bg-blue-100';
                let statusText = '進行中';
                let checkboxState = false;
                
                if (task.completed) {
                    if (task.status === 'claimed') {
                        statusClass = 'text-green-600 bg-green-100';
                        statusText = '已完成';
                        checkboxState = true;
                    } else {
                        statusClass = 'text-yellow-600 bg-yellow-100';
                        statusText = '待領取';
                    }
                }
                
                taskElement.innerHTML = `
                    <input type="checkbox" ${checkboxState ? 'checked' : ''} disabled class="mr-3 h-5 w-5 text-primary rounded border-gray-300 focus:ring-primary">
                    <div class="flex-1">
                        <p class="text-sm font-medium">${task.name}</p>
                        <p class="text-xs text-gray-500">${task.description}${task.type === 'counter' ? ` (${task.currentValue}/${task.targetValue})` : task.type === 'timed' ? ` (${Math.floor(task.currentTime/60)}分${task.currentTime%60}秒/${Math.floor(task.targetTime/60)}分${task.targetTime%60}秒)` : ''}</p>
                    </div>
                    <span class="text-xs ${statusClass} px-2 py-1 rounded-full">${statusText}</span>
                `;
                
                // 如果任務已完成但未領取獎勵，添加領取按鈕
                if (task.completed && task.status !== 'claimed') {
                    const claimButton = document.createElement('button');
                    claimButton.className = 'ml-2 text-xs bg-primary text-white px-2 py-1 rounded-full hover:bg-primary/80 transition-colors';
                    claimButton.textContent = '領取';
                    claimButton.onclick = () => claimTaskReward(task.id);
                    taskElement.querySelector('.flex-1').appendChild(claimButton);
                }
                
                taskList.appendChild(taskElement);
            });
        }
        
        // 檢查成就解鎖條件
        function checkAchievements() {
            achievements.forEach(achievement => {
                if (!achievement.unlocked) {
                    // 根據成就類型檢查解鎖條件
                    let unlocked = false;
                    
                    switch(achievement.type) {
                        case "counter":
                            unlocked = gameStats[achievement.condition.split(' ')[0]] >= achievement.target;
                            break;
                            
                        case "timed":
                            unlocked = gameStats[achievement.condition.split(' ')[0]] >= achievement.target;
                            break;
                            
                        case "collection":
                            unlocked = playerInventory.length >= achievement.target;
                            if (unlocked) {
                                gameStats.collectedItems = playerInventory.length;
                                saveGameStatsToStorage();
                            }
                            break;
                            
                        case "secret":
                            // 秘密成就使用自定義條件
                            unlocked = eval(achievement.condition);
                            break;
                            
                        default:
                            // 默認使用條件表達式
                            unlocked = eval(achievement.condition);
                    }
                    
                    if (unlocked) {
                        unlockAchievement(achievement);
                    }
                }
            });
        }
        
        // 解鎖成就
        function unlockAchievement(achievement) {
            achievement.unlocked = true;
            saveAchievementsToStorage();
            
            // 發放成就獎勵
            grantAchievementReward(achievement);
            
            // 顯示成就解鎖通知
            showAchievementNotification(achievement);
            
            // 更新成就列表
            renderAchievements();
        }
        
        // 顯示成就通知
        function showAchievementNotification(achievement) {
            achievementName.textContent = achievement.name;
            achievementDesc.textContent = achievement.description;
            
            achievementNotification.classList.remove('translate-x-full');
            
            setTimeout(() => {
                achievementNotification.classList.add('translate-x-full');
            }, 5000);
        }
        
        // 發放成就獎勵
        function grantAchievementReward(achievement) {
            const reward = achievement.reward;
            let rewardMessage = "獲得成就獎勵: ";
            
            if (reward.diamonds) {
                stats.diamonds += reward.diamonds;
                rewardMessage += `${reward.diamonds} 鑽石`;
                animateDiamondReward(reward.diamonds);
            }
            
            if (reward.title) {
                // 這裡可以實現稱號系統
                rewardMessage += `, 稱號: ${reward.title}`;
            }
            
            if (reward.item) {
                // 添加特殊物品到庫存
                const specialItem = {
                    id: `special_${reward.item}`,
                    name: reward.item === "friendshipCollar" ? "友誼項圈" : "彩虹項圈",
                    description: "特殊成就獎勵物品",
                    type: "special"
                };
                
                addItemToInventory(specialItem);
                rewardMessage += `, ${specialItem.name}`;
                animateItemReward(specialItem);
            }
            
            if (reward.ability) {
                unlockAbility(reward.ability);
                        // 解锁能力

                    }
                }                 
        function unlockAbility(abilityId) {
            if (!playerAbilities.includes(abilityId)) {
                playerAbilities.push(abilityId);
                showPetMessage(`恭喜！你解锁了新能力: ${abilityId === 'healthRegen' ? '健康恢复' : '特殊能力'}`);
                savePlayerAbilitiesToStorage();
            }
        }
        
        // 添加物品到库存
        function addItemToInventory(item) {
            playerInventory.push(item);
            saveInventoryToStorage();
            renderInventory();
        }
        
        // 渲染库存
        function renderInventory() {
            // 实现库存渲染逻辑
        }
        
        // 渲染成就列表
        function renderAchievements() {
            if (!achievementsGrid) return;
            
            // 清空现有成就
            achievementsGrid.innerHTML = '';
            
            // 过滤掉隐藏的成就
            const visibleAchievements = achievements.filter(a => !a.hidden || a.unlocked);
            
            // 更新成就统计
            const unlockedCount = visibleAchievements.filter(a => a.unlocked).length;
            achievementsStats.textContent = `${unlockedCount}/${visibleAchievements.length} 已解锁`;
            
            // 添加所有成就
            visibleAchievements.forEach(achievement => {
                const achievementElement = document.createElement('div');
                achievementElement.className = `achievement-card ${achievement.unlocked ? 'bg-white/80' : 'bg-gray-100/80'} rounded-xl shadow p-3 flex flex-col items-center`;
                
                let iconClass = achievement.unlocked ? 'fa-trophy text-yellow-500' : 'fa-lock text-gray-400';
                let iconBg = achievement.unlocked ? 'bg-yellow-100' : 'bg-gray-200';
                
                achievementElement.innerHTML = `
                    <div class="w-12 h-12 ${iconBg} rounded-full flex items-center justify-center mb-2">
                        <i class="fa ${iconClass} text-xl"></i>
                    </div>
                    <h4 class="text-xs font-medium text-center ${achievement.unlocked ? 'text-neutral' : 'text-gray-500'}">
                        ${achievement.name}
                    </h4>
                    <p class="text-xs text-center text-gray-500 mt-1">
                        ${achievement.unlocked ? achievement.description : '未解锁'}
                    </p>
                    ${achievement.unlocked ? `<div class="text-xs text-green-600 mt-1">已完成</div>` : ''}
                `;
                
                achievementsGrid.appendChild(achievementElement);
            });
        }
        
        // 页面导航
        function navigateTo(page) {
            // 移除所有导航链接的活动状态
            navLinks.forEach(link => {
                link.classList.remove('text-primary');
                link.classList.add('text-gray-500');
            });
            
            // 添加当前导航链接的活动状态
            const activeLink = document.querySelector(`footer a[data-page="${page}"]`);
            if (activeLink) {
                activeLink.classList.remove('text-gray-500');
                activeLink.classList.add('text-primary');
            }
            
            // 实现页面切换逻辑
            // 这里可以根据需要显示/隐藏不同的内容区域
        }
        
        // 绑定导航事件
        navLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const page = link.getAttribute('data-page');
                navigateTo(page);
            });
        });
        
        // 初始化页面
        navigateTo('home');
        
        // 保存数据到本地存储
        function saveGameState() {
            localStorage.setItem('petGameStats', JSON.stringify(stats));
            localStorage.setItem('petGameLevel', JSON.stringify(playerLevel));
            localStorage.setItem('petGameExperience', JSON.stringify(playerExperience));
            saveTasksToStorage();
            saveAchievementsToStorage();
            saveGameStatsToStorage();
            saveInventoryToStorage();
            savePlayerAbilitiesToStorage();
        }
        
        // 从本地存储加载数据
        function loadGameState() {
            const savedStats = localStorage.getItem('petGameStats');
            const savedLevel = localStorage.getItem('petGameLevel');
            const savedExperience = localStorage.getItem('petGameExperience');
            
            if (savedStats) {
                stats = JSON.parse(savedStats);
            }
            
            if (savedLevel) {
                playerLevel = JSON.parse(savedLevel);
            }
            
            if (savedExperience) {
                playerExperience = JSON.parse(savedExperience);
            }
            
            loadTasksFromStorage();
            loadAchievementsFromStorage();
            loadGameStatsFromStorage();
            loadInventoryFromStorage();
            loadPlayerAbilitiesFromStorage();
            
            updateStats();
            renderTasks();
            renderAchievements();
        }
        
        // 保存任务到本地存储
        function saveTasksToStorage() {
            localStorage.setItem('petGameTasks', JSON.stringify(tasks));
        }
        
        // 从本地存储加载任务
        function loadTasksFromStorage() {
            const savedTasks = localStorage.getItem('petGameTasks');
            if (savedTasks) {
                const parsedTasks = JSON.parse(savedTasks);
                // 合并已保存的任务数据到当前任务数组
                parsedTasks.forEach(savedTask => {
                    const taskIndex = tasks.findIndex(t => t.id === savedTask.id);
                    if (taskIndex !== -1) {
                        tasks[taskIndex] = { ...tasks[taskIndex], ...savedTask };
                    }
                });
            }
        }
        
        // 保存成就到本地存储
        function saveAchievementsToStorage() {
            localStorage.setItem('petGameAchievements', JSON.stringify(achievements));
        }
        
        // 从本地存储加载成就
        function loadAchievementsFromStorage() {
            const savedAchievements = localStorage.getItem('petGameAchievements');
            if (savedAchievements) {
                const parsedAchievements = JSON.parse(savedAchievements);
                // 合并已保存的成就数据到当前成就数组
                parsedAchievements.forEach(savedAchievement => {
                    const achievementIndex = achievements.findIndex(a => a.id === savedAchievement.id);
                    if (achievementIndex !== -1) {
                        achievements[achievementIndex] = { ...achievements[achievementIndex], ...savedAchievement };
                    }
                });
            }
        }
        
        // 保存游戏统计数据到本地存储
        function saveGameStatsToStorage() {
            localStorage.setItem('petGameStatsData', JSON.stringify(gameStats));
        }
        
        // 从本地存储加载游戏统计数据
        function loadGameStatsFromStorage() {
            const savedGameStats = localStorage.getItem('petGameStatsData');
            if (savedGameStats) {
                Object.assign(gameStats, JSON.parse(savedGameStats));
            }
        }
        
        // 保存库存到本地存储
        function saveInventoryToStorage() {
            localStorage.setItem('petGameInventory', JSON.stringify(playerInventory));
        }
        
        // 从本地存储加载库存
        function loadInventoryFromStorage() {
            const savedInventory = localStorage.getItem('petGameInventory');
            if (savedInventory) {
                playerInventory = JSON.parse(savedInventory);
            }
        }
        
        // 保存能力到本地存储
        function savePlayerAbilitiesToStorage() {
            localStorage.setItem('petGameAbilities', JSON.stringify(playerAbilities));
        }
        
        // 从本地存储加载能力
        function loadPlayerAbilitiesFromStorage() {
            const savedAbilities = localStorage.getItem('petGameAbilities');
            if (savedAbilities) {
                playerAbilities = JSON.parse(savedAbilities);
            }
        }
        
        // 游戏启动时加载保存的游戏状态
        window.addEventListener('DOMContentLoaded', () => {
            loadGameState();
            
            // 定期保存游戏状态
            setInterval(saveGameState, 30000); // 每30秒保存一次
            
            // 绑定商店物品点击事件
            document.querySelectorAll('.btn-item').forEach(item => {
                item.addEventListener('click', () => {
                    const itemId = item.getAttribute('data-item');
                    const itemData = items[itemId];
                    
                    if (itemData) {
                        showModal(
                            itemData.name, 
                            `${itemData.description}，消耗 ${itemData.price} 钻石`, 
                            () => {
                                if (stats.diamonds >= itemData.price) {
                                    // 购买成功
                                    stats.diamonds -= itemData.price;
                                    
                                    // 根据物品类型应用效果
                                    if (itemData.type === 'consumable') {
                                        switch(itemId) {
                                            case 'food':
                                                stats.hunger += itemData.effect;
                                                showPetMessage('谢谢喂食，真好吃！');
                                                gameStats.feedCount += 1;
                                                updateTask(1, 1);
                                                break;
                                            case 'toy':
                                                stats.mood += itemData.effect;
                                                showPetMessage('玩得真开心！');
                                                gameStats.playCount += 1;
                                                updateTask(2, 1);
                                                break;
                                            case 'shampoo':
                                                stats.health += itemData.effect;
                                                showPetMessage('好舒服，谢谢你！');
                                                gameStats.cleanCount += 1;
                                                break;
                                        }
                                    } else {
                                        // 非消耗品添加到库存
                                        addItemToInventory(itemData);
                                        showPetMessage(`你获得了新物品: ${itemData.name}`);
                                    }
                                    
                                    updateStats();
                                    saveGameState();
                                } else {
                                    showModal('钻石不足', '你的钻石不够购买此物品', () => {});
                                }
                            }
                        );
                    }
                });
            });
            
            // 绑定商店切换按钮事件
            document.getElementById('shop-toggle').addEventListener('click', () => {
                // 这里可以实现商店展开/收起功能
                showModal('物品商店', '所有可用物品将在这里显示', () => {});
            });
        });
    </script>
</body>
</html>
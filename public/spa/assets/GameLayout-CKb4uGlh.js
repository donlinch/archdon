import{c as R,g as V,i as se,e as U,l as X,a as h,h as b,b as T,p as j,d as ie,r as S,o as re,f as ue,j as Z,v as ce,s as W,n as de,k as fe,m as me,q as F,t as ve,u as D,w as H,x as ge,y as ee,z as he,A as te,B as be,C as ye,Q as we,D as k,E as Se,F as N,G as A,H as P,I,J as q,K as w,L as x,M as _e,N as E,O as G,P as oe,R as O,S as xe,T as K,U as Ce}from"./index-BAhK0N-H.js";import{Q as qe,a as J,b as Be,c as pe,C as $e}from"./ClosePopup-B36s9-rl.js";import Ie from"./eat-logo-word-rguyzZIN.js";import Ae from"./SunnyYummy-CJFbYPjp.js";import{u as ae}from"./auth-store-BWEl8PJj.js";import{u as ne}from"./use-quasar-CDjoMZJi.js";import{_ as le}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{a as ze}from"./index-Dq7h7Pqt.js";import"./selection-Dv9rOAjt.js";const Y=R({name:"QPageContainer",setup(e,{slots:n}){const{proxy:{$q:l}}=V(),a=se(X,U);if(a===U)return console.error("QPageContainer needs to be child of QLayout"),U;j(ie,!0);const r=h(()=>{const s={};return a.header.space===!0&&(s.paddingTop=`${a.header.size}px`),a.right.space===!0&&(s[`padding${l.lang.rtl===!0?"Left":"Right"}`]=`${a.right.size}px`),a.footer.space===!0&&(s.paddingBottom=`${a.footer.size}px`),a.left.space===!0&&(s[`padding${l.lang.rtl===!0?"Right":"Left"}`]=`${a.left.size}px`),s});return()=>b("div",{class:"q-page-container",style:r.value},T(n.default))}}),Le=R({name:"QForm",props:{autofocus:Boolean,noErrorFocus:Boolean,noResetFocus:Boolean,greedy:Boolean,onSubmit:Function},emits:["reset","validationSuccess","validationError"],setup(e,{slots:n,emit:l}){const a=V(),r=S(null);let s=0;const f=[];function g(o){const i=typeof o=="boolean"?o:e.noErrorFocus!==!0,p=++s,L=(u,t)=>{l(`validation${u===!0?"Success":"Error"}`,t)},z=u=>{const t=u.validate();return typeof t.then=="function"?t.then(c=>({valid:c,comp:u}),c=>({valid:!1,comp:u,err:c})):Promise.resolve({valid:t,comp:u})};return(e.greedy===!0?Promise.all(f.map(z)).then(u=>u.filter(t=>t.valid!==!0)):f.reduce((u,t)=>u.then(()=>z(t).then(c=>{if(c.valid===!1)return Promise.reject(c)})),Promise.resolve()).catch(u=>[u])).then(u=>{if(u===void 0||u.length===0)return p===s&&L(!0),!0;if(p===s){const{comp:t,err:c}=u[0];if(c!==void 0&&console.error(c),L(!1,t),i===!0){const C=u.find(({comp:_})=>typeof _.focus=="function"&&ce(_.$)===!1);C!==void 0&&C.comp.focus()}}return!1})}function y(){s++,f.forEach(o=>{typeof o.resetValidation=="function"&&o.resetValidation()})}function m(o){o!==void 0&&W(o);const i=s+1;g().then(p=>{i===s&&p===!0&&(e.onSubmit!==void 0?l("submit",o):o?.target!==void 0&&typeof o.target.submit=="function"&&o.target.submit())})}function B(o){o!==void 0&&W(o),l("reset"),de(()=>{y(),e.autofocus===!0&&e.noResetFocus!==!0&&d()})}function d(){fe(()=>{if(r.value===null)return;(r.value.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||r.value.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||r.value.querySelector("[autofocus], [data-autofocus]")||Array.prototype.find.call(r.value.querySelectorAll("[tabindex]"),i=>i.tabIndex!==-1))?.focus({preventScroll:!0})})}j(me,{bindComponent(o){f.push(o)},unbindComponent(o){const i=f.indexOf(o);i!==-1&&f.splice(i,1)}});let v=!1;return re(()=>{v=!0}),ue(()=>{v===!0&&e.autofocus===!0&&d()}),Z(()=>{e.autofocus===!0&&d()}),Object.assign(a.proxy,{validate:g,resetValidation:y,submit:m,reset:B,focus:d,getValidationComponents:()=>f}),()=>b("form",{class:"q-form",ref:r,onSubmit:m,onReset:B},T(n.default))}}),ke=R({name:"QLayout",props:{container:Boolean,view:{type:String,default:"hhh lpr fff",validator:e=>/^(h|l)h(h|r) lpr (f|l)f(f|r)$/.test(e.toLowerCase())},onScroll:Function,onScrollHeight:Function,onResize:Function},setup(e,{slots:n,emit:l}){const{proxy:{$q:a}}=V(),r=S(null),s=S(a.screen.height),f=S(e.container===!0?0:a.screen.width),g=S({position:0,direction:"down",inflectionPoint:0}),y=S(0),m=S(ve.value===!0?0:F()),B=h(()=>"q-layout q-layout--"+(e.container===!0?"containerized":"standard")),d=h(()=>e.container===!1?{minHeight:a.screen.height+"px"}:null),v=h(()=>m.value!==0?{[a.lang.rtl===!0?"left":"right"]:`${m.value}px`}:null),o=h(()=>m.value!==0?{[a.lang.rtl===!0?"right":"left"]:0,[a.lang.rtl===!0?"left":"right"]:`-${m.value}px`,width:`calc(100% + ${m.value}px)`}:null);function i(t){if(e.container===!0||document.qScrollPrevented!==!0){const c={position:t.position.top,direction:t.direction,directionChanged:t.directionChanged,inflectionPoint:t.inflectionPoint.top,delta:t.delta.top};g.value=c,e.onScroll!==void 0&&l("scroll",c)}}function p(t){const{height:c,width:C}=t;let _=!1;s.value!==c&&(_=!0,s.value=c,e.onScrollHeight!==void 0&&l("scrollHeight",c),z()),f.value!==C&&(_=!0,f.value=C),_===!0&&e.onResize!==void 0&&l("resize",t)}function L({height:t}){y.value!==t&&(y.value=t,z())}function z(){if(e.container===!0){const t=s.value>y.value?F():0;m.value!==t&&(m.value=t)}}let $=null;const u={instances:{},view:h(()=>e.view),isContainer:h(()=>e.container),rootRef:r,height:s,containerHeight:y,scrollbarWidth:m,totalWidth:h(()=>f.value+m.value),rows:h(()=>{const t=e.view.toLowerCase().split(" ");return{top:t[0].split(""),middle:t[1].split(""),bottom:t[2].split("")}}),header:D({size:0,offset:0,space:!1}),right:D({size:300,offset:0,space:!1}),footer:D({size:0,offset:0,space:!1}),left:D({size:300,offset:0,space:!1}),scroll:g,animate(){$!==null?clearTimeout($):document.body.classList.add("q-body--layout-animate"),$=setTimeout(()=>{$=null,document.body.classList.remove("q-body--layout-animate")},155)},update(t,c,C){u[t][c]=C}};if(j(X,u),F()>0){let t=function(){_=null,Q.classList.remove("hide-scrollbar")},c=function(){if(_===null){if(Q.scrollHeight>a.screen.height)return;Q.classList.add("hide-scrollbar")}else clearTimeout(_);_=setTimeout(t,300)},C=function(M){_!==null&&M==="remove"&&(clearTimeout(_),t()),window[`${M}EventListener`]("resize",c)},_=null;const Q=document.body;H(()=>e.container!==!0?"add":"remove",C),e.container!==!0&&C("add"),ge(()=>{C("remove")})}return()=>{const t=ee(n.default,[b(qe,{onScroll:i}),b(J,{onResize:p})]),c=b("div",{class:B.value,style:d.value,ref:e.container===!0?void 0:r,tabindex:-1},t);return e.container===!0?b("div",{class:"q-layout-container overflow-hidden",ref:r},[b(J,{onResize:L}),b("div",{class:"absolute-full",style:v.value},[b("div",{class:"scroll",style:o.value},[c])])]):c}}}),Pe=["top","middle","bottom"],Re=R({name:"QBadge",props:{color:String,textColor:String,floating:Boolean,transparent:Boolean,multiLine:Boolean,outline:Boolean,rounded:Boolean,label:[Number,String],align:{type:String,validator:e=>Pe.includes(e)}},setup(e,{slots:n}){const l=h(()=>e.align!==void 0?{verticalAlign:e.align}:null),a=h(()=>{const r=e.outline===!0&&e.color||e.textColor;return`q-badge flex inline items-center no-wrap q-badge--${e.multiLine===!0?"multi":"single"}-line`+(e.outline===!0?" q-badge--outline":e.color!==void 0?` bg-${e.color}`:"")+(r!==void 0?` text-${r}`:"")+(e.floating===!0?" q-badge--floating":"")+(e.rounded===!0?" q-badge--rounded":"")+(e.transparent===!0?" q-badge--transparent":"")});return()=>b("div",{class:a.value,style:l.value,role:"status","aria-label":e.label},ee(n.default,e.label!==void 0?[e.label]:[]))}}),De=Object.keys(te);function Ve(e){return De.reduce((n,l)=>{const a=e[l];return a!==void 0&&(n[l]=a),n},{})}const Qe=R({name:"QBtnDropdown",props:{...te,...he,modelValue:Boolean,split:Boolean,dropdownIcon:String,contentClass:[Array,String,Object],contentStyle:[Array,String,Object],cover:Boolean,persistent:Boolean,noEscDismiss:Boolean,noRouteDismiss:Boolean,autoClose:Boolean,noRefocus:Boolean,noFocus:Boolean,menuAnchor:{type:String,default:"bottom end"},menuSelf:{type:String,default:"top end"},menuOffset:Array,disableMainBtn:Boolean,disableDropdown:Boolean,noIconAnimation:Boolean,toggleAriaLabel:String},emits:["update:modelValue","click","beforeShow","show","beforeHide","hide"],setup(e,{slots:n,emit:l}){const{proxy:a}=V(),r=S(e.modelValue),s=S(null),f=be(),g=h(()=>{const t={"aria-expanded":r.value===!0?"true":"false","aria-haspopup":"true","aria-controls":f.value,"aria-label":e.toggleAriaLabel||a.$q.lang.label[r.value===!0?"collapse":"expand"](e.label)};return(e.disable===!0||e.split===!1&&e.disableMainBtn===!0||e.disableDropdown===!0)&&(t["aria-disabled"]="true"),t}),y=h(()=>"q-btn-dropdown__arrow"+(r.value===!0&&e.noIconAnimation===!1?" rotate-180":"")+(e.split===!1?" q-btn-dropdown__arrow-container":"")),m=h(()=>ye(e)),B=h(()=>Ve(e));H(()=>e.modelValue,t=>{s.value?.[t?"show":"hide"]()}),H(()=>e.split,u);function d(t){r.value=!0,l("beforeShow",t)}function v(t){l("show",t),l("update:modelValue",!0)}function o(t){r.value=!1,l("beforeHide",t)}function i(t){l("hide",t),l("update:modelValue",!1)}function p(t){l("click",t)}function L(t){Se(t),u(),l("click",t)}function z(t){s.value?.toggle(t)}function $(t){s.value?.show(t)}function u(t){s.value?.hide(t)}return Object.assign(a,{show:$,hide:u,toggle:z}),Z(()=>{e.modelValue===!0&&$()}),()=>{const t=[b(we,{class:y.value,name:e.dropdownIcon||a.$q.iconSet.arrow.dropdown})];return e.disableDropdown!==!0&&t.push(b(Be,{ref:s,id:f.value,class:e.contentClass,style:e.contentStyle,cover:e.cover,fit:!0,persistent:e.persistent,noEscDismiss:e.noEscDismiss,noRouteDismiss:e.noRouteDismiss,autoClose:e.autoClose,noFocus:e.noFocus,noRefocus:e.noRefocus,anchor:e.menuAnchor,self:e.menuSelf,offset:e.menuOffset,separateClosePopup:!0,transitionShow:e.transitionShow,transitionHide:e.transitionHide,transitionDuration:e.transitionDuration,onBeforeShow:d,onShow:v,onBeforeHide:o,onHide:i},n.default)),e.split===!1?b(k,{class:"q-btn-dropdown q-btn-dropdown--simple",...B.value,...g.value,disable:e.disable===!0||e.disableMainBtn===!0,noWrap:!0,round:!1,onClick:p},{default:()=>T(n.label,[]).concat(t),loading:n.loading}):b(pe,{class:"q-btn-dropdown q-btn-dropdown--split no-wrap q-btn-item",rounded:e.rounded,square:e.square,...m.value,glossy:e.glossy,stretch:e.stretch},()=>[b(k,{class:"q-btn-dropdown--current",...B.value,disable:e.disable===!0||e.disableMainBtn===!0,noWrap:!0,round:!1,onClick:L},{default:n.label,loading:n.loading}),b(k,{class:"q-btn-dropdown__arrow-container q-anchor--skip",...g.value,...m.value,disable:e.disable===!0||e.disableDropdown===!0,rounded:e.rounded,color:e.color,textColor:e.textColor,dense:e.dense,size:e.size,padding:e.padding,ripple:e.ripple},()=>t)])}}}),Ue={class:"user-status-container"},Fe={class:"user-status"},Ee=["src"],He={class:"row no-wrap q-pa-md"},Ne={class:"column items-center"},Oe=["src"],Te={class:"text-subtitle1 q-mb-xs"},je={key:1,class:"user-status inactive"},Me=["src"],We=Object.assign({name:"UserStatus"},{__name:"UserStatus",setup(e){const n=ae(),l=ne(),a=()=>{n.logout(),l.notify({color:"info",message:"您已成功登出",icon:"logout"})};return(r,s)=>(A(),N("div",Ue,[I(n).isLoggedIn?(A(),P(Qe,{key:0,flat:"",dense:"","no-caps":"",class:"user-btn-dropdown"},{label:q(()=>[w("div",Fe,[x(E,{size:"40px"},{default:q(()=>[w("img",{src:I(n).avatar,alt:"User Avatar"},null,8,Ee)]),_:1})])]),default:q(()=>[w("div",He,[w("div",Ne,[x(E,{size:"72px",class:"q-mb-md"},{default:q(()=>[w("img",{src:I(n).avatar,alt:"User Avatar"},null,8,Oe)]),_:1}),w("div",Te,[G(O(I(n).username)+" ",1),I(n).roleName?(A(),P(Re,{key:0,align:"middle",color:"orange"},{default:q(()=>[G(O(I(n).roleName),1)]),_:1})):oe("",!0)]),_e(x(k,{color:"negative",label:"登出",push:"",size:"sm",onClick:a,class:"q-mt-md",icon:"logout"},null,512),[[$e]])])])]),_:1})):(A(),N("div",je,[x(E,{size:"40px"},{default:q(()=>[w("img",{src:I(n).avatar,alt:"User Avatar"},null,8,Me)]),_:1})]))]))}}),Ge=le(We,[["__scopeId","data-v-3ef7e990"]]),Ke={class:"login-container"},Je={class:"login-form-card"},Ye={class:"row justify-between items-center q-mt-md"},Xe={key:0,class:"text-negative q-mt-sm text-center"},Ze={class:"row justify-center q-mt-md"},et=Object.assign({name:"GameLayout"},{__name:"GameLayout",setup(e){const n=ae(),l=ne(),a=S(""),r=S(""),s=S(!0),f=S(!1),g=S(""),y=h(()=>window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"),m=async()=>{try{f.value=!0,g.value="";const d=await ze.post(`${y.value?"http://localhost:3000":""}/api/box/users/login`,{username:a.value,password:r.value});if(d.data.success&&d.data.token){const{token:v,user:o}=d.data;if(console.log("從後端收到的 User Data:",o),localStorage.setItem("boxCurrentUserId",o.userId.toString()),localStorage.setItem(`boxUserToken_${o.userId}`,v),localStorage.setItem("boxCurrentUsername",o.username),o.displayName?localStorage.setItem("boxCurrentDisplayName",o.displayName):localStorage.setItem("boxCurrentDisplayName",o.username),o.roleName&&localStorage.setItem("boxCurrentUserRoleName",o.roleName),o.profileImageUrl){let i=o.profileImageUrl;i.startsWith("/")&&(i=`${y.value?"http://localhost:3000":""}${i}`),localStorage.setItem("boxCurrentUserAvatar",i)}else localStorage.setItem("boxCurrentUserAvatar",`${y.value?"http://localhost:3000":""}/images/a01girlmove.gif`);n.initializeAuth(),l.notify({color:"positive",message:"登入成功",icon:"check"})}else throw new Error("登入失敗: 無效的回應格式")}catch(d){d.response?d.response.status===401?g.value="帳號或密碼錯誤":g.value=`登入失敗: ${d.response.data?.error||"伺服器錯誤"}`:d.request?g.value="無法連接到伺服器，請確認後端服務已啟動":g.value=d.message||"發生未知錯誤"}finally{f.value=!1}},B=()=>{y.value?window.location.href="http://localhost:3000/games.html":window.location.href="/game.html"};return(d,v)=>{const o=xe("router-view");return A(),P(ke,{view:"lHh Lpr lFf"},{default:q(()=>[x(Ge),I(n).isLoggedIn?(A(),P(Y,{key:0},{default:q(()=>[x(o)]),_:1})):(A(),P(Y,{key:1},{default:q(()=>[w("div",Ke,[w("div",Je,[v[3]||(v[3]=w("div",{class:"logo-header"},[w("img",{src:Ie,alt:"Eat Funny Girl Logo",class:"logo-image"}),w("img",{src:Ae,alt:"Sunny Yummy Logo",class:"logo-image"})],-1)),x(Le,{onSubmit:m,class:"q-gutter-md"},{default:q(()=>[x(K,{modelValue:a.value,"onUpdate:modelValue":v[0]||(v[0]=i=>a.value=i),label:"使用者名稱",outlined:"",dense:"",rules:[i=>!!i||"請輸入使用者名稱"]},null,8,["modelValue","rules"]),x(K,{modelValue:r.value,"onUpdate:modelValue":v[1]||(v[1]=i=>r.value=i),label:"密碼",type:"password",outlined:"",dense:"",rules:[i=>!!i||"請輸入密碼"]},null,8,["modelValue","rules"]),w("div",Ye,[x(Ce,{modelValue:s.value,"onUpdate:modelValue":v[2]||(v[2]=i=>s.value=i),label:"記住我"},null,8,["modelValue"]),x(k,{type:"submit",color:"primary",label:"登入",loading:f.value},null,8,["loading"])]),g.value?(A(),N("div",Xe,O(g.value),1)):oe("",!0),w("div",Ze,[x(k,{flat:"",color:"secondary",label:"回遊戲頁面",onClick:B,icon:"arrow_back"})])]),_:1})])])]),_:1}))]),_:1})}}}),ct=le(et,[["__scopeId","data-v-1f6f8926"]]);export{ct as default};
